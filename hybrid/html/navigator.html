<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Marker</title>
    <style type="text/css">
      html,
      body {
        width: 100%;
        height: 100%;
      }
      #container {
        width: 100%;
        height: calc(100% - 6vh)
      }
      * {
        margin: 0px;
        padding: 0px;
      }
      body,
      button,
      input,
      select,
      textarea {
        font: 12px/16px Verdana, Helvetica, Arial, sans-serif;
      }
      * {
        touch-action: pan-y;
      }
      .loading {
        width: 30px;
        height: 30px;
        border: 2px solid #ffffff;
        border-top-color: transparent;
        border-radius: 100%;
        animation: circle infinite 0.75s linear;
      }
      .loading-parl {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background-color: #9f9f9f;
        color: white;
        border: 1px solid transparent;
        padding: 5px 20px;
        border-radius: 10px;
      }
      .alert-mask {
        position: absolute;
        top:0;
        left:0;
        height: 100vh;
        width: 100vw;
        display: none;
		    z-index: 111;
        font-size: 16px;
        background-color: rgba(51, 51, 51, 0.555);
      }
      .alert-parl {
        position: absolute;
        top: 40%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        border: 1px solid #ccc;
        width: 64%;
        height: 116px;
        border-radius: 10px;
        justify-content: space-around;
      }
      .btn {
        text-align: center;
        border: 1px solid transparent;
        border-top-color: #ccc;
        height: 30px;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #msg {
        padding: 19px 20px 2px 30px;
        text-align: center;
        display: flex;
        flex: 1;
        justify-content: center;
        align-items: center;
      }

      @keyframes circle {
        0% {
          transform: rotate(0);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .navigator {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 18px;
        width: 100vw;
        height: 6vh;
        position: absolute;
        bottom: 0;
        background-color: #da2020;
        color: white;
      }
    </style>
    <script src="./component.js"></script>
    <script
      type="text/javascript"
      src="https://api.map.baidu.com/api?v=2.0&ak=3ORKMeLyw6anANxGhKwU0K3kOJdnoY7x"
    ></script>
    <script src="./navigator.js"></script>
    <script>
      var map = null;
      function setLoading(flag) {
        let loading = document.querySelector(".loading-parl");
        loading.style.display = flag ? "black" : "none";
      }
      function initMap() {
        map = new BMap.Map("container");
        map.centerAndZoom(new BMap.Point(116.397135, 39.908359), 13);
        map.enableScrollWheelZoom(true);
        setLoading(false);
      }
      function init(params) {
        console.log("hybrid/html/navigator.html", params);
        params = JSON.parse(params);
        let marker = params.marker;
        cacheMarker = marker;
        let beforeMsg = params.beforeMsg;
        if (!marker) return;
        var center = new BMap.Point(
          (beforeMsg || marker).longitude,
          (beforeMsg || marker).latitude
        );
        if (map) {
          map.panTo(center);
        } else {
          map = new BMap.Map("container");
          map.centerAndZoom(center, 13);
          map.enableScrollWheelZoom(true);
        }
        var point = new BMap.Point(marker.longitude, marker.latitude);
        var markerPoint = new BMap.Marker(point);
        map.addOverlay(markerPoint);
        
        var opts = {
          position: point,
          offset: new BMap.Size(-20, -30)
        };
        var label = new BMap.Label(marker.title, opts);
        label.setStyle({
          color: "#000000",
          fontSize: "12px",
          border: "1px solid #005EFF",
          backgroundColor: "#FFFFFF",
          padding: "3px"
        });
        map.addOverlay(label);
      }
    </script>
  </head>
  <body onload="initMap()">
    <div id="container"></div>
    <div class="loading-parl">
      <div class="loading"></div>
      <div>加载中...</div>
    </div>
    <div class="alert-mask">
      <div class="alert-parl">
        <div id="msg"></div>
        <div class="btn" onclick="closeAlert()">确定</div>
      </div>
    </div>
    <div class="navigator" onclick="chooseMap()">导航</div>
  </body>
</html>
