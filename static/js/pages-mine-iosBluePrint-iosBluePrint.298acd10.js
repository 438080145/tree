(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-mine-iosBluePrint-iosBluePrint"],{1444:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){}));var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",{staticClass:"content"},[i("v-uni-button",{staticClass:"btn sure",attrs:{type:"primary",loading:e.isSearching},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.startSearch.apply(void 0,arguments)}}},[e._v("开始搜索 ")]),i("v-uni-button",{staticClass:"btn",attrs:{type:"warn"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.stopSearch.apply(void 0,arguments)}}},[e._v("停止搜索")]),e._l(e.list,(function(t){return i("v-uni-view",{key:t.deviceId,attrs:{"data-title":t.deviceId,"data-name":t.name,"data-advertisData":t.advertisServiceUUIDs},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.bindViewTap.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"item"},[i("v-uni-view",{staticClass:"name block"},[e._v(e._s(t.name))])],1)],1)}))],2)},o=[]},"565f":function(e,t,i){"use strict";i.r(t);var n=i("1444"),o=i("7421");for(var a in o)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return o[e]}))}(a);i("b644");var c=i("828b"),r=Object(c["a"])(o["default"],n["b"],n["c"],!1,null,"022058a8",null,!1,n["a"],void 0);t["default"]=r.exports},7421:function(e,t,i){"use strict";i.r(t);var n=i("a54e"),o=i.n(n);for(var a in n)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(a);t["default"]=o.a},a54e:function(e,t,i){"use strict";(function(e){i("6a54"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i("c223"),i("8f71"),i("bf0f"),i("aa9c");var n=i("8f59"),o={data:function(){return{isSearching:!1,list:[],services:[],serviceId:0,writeCharacter:!1,readCharacter:!1,notifyCharacter:!1,secondGetSeciveId:!0}},computed:(0,n.mapState)(["sysinfo","Bluetooth"]),onLoad:function(){this.blueInit()},onUnload:function(){this.isSearching&&uni.stopBluetoothDevicesDiscovery()},methods:{errorCodeTip:function(e){0==e||(1e4==e?uni.showToast({title:"未初始化蓝牙适配器",icon:"none"}):10001==e?uni.showToast({title:"当前蓝牙适配器不可用",icon:"none"}):10002==e?uni.showToast({title:"没有找到指定设备",icon:"none"}):10003==e?uni.showToast({title:"连接失败",icon:"none"}):10004==e?uni.showToast({title:"没有找到指定服务",icon:"none"}):10005==e?uni.showToast({title:"请再点击一次！",icon:"none"}):10006==e?uni.showToast({title:"当前连接已断开",icon:"none"}):10007==e?uni.showToast({title:"当前特征值不支持此操作",icon:"none"}):10008==e?uni.showToast({title:"其余所有系统上报的异常",icon:"none"}):10009==e&&uni.showToast({title:"Android 系统特有，系统版本低于 4.3 不支持 BLE",icon:"none"}))},blueInit:function(){uni.openBluetoothAdapter({success:function(e){},fail:function(){uni.showModal({title:"提示",content:"蓝牙初始化失败，请打开蓝牙"})}})},startSearch:function(){var t=this;uni.openBluetoothAdapter({success:function(i){uni.getBluetoothAdapterState({success:function(i){if(e.log("getBluetoothAdapterState:",i),i.available){if(t.isSearching=!0,i.discovering)return void uni.showToast({title:"正在搜索附近打印机设备",icon:"none"});t.getBluetoothDevices()}else uni.showModal({title:"提示",content:"本机蓝牙不可用"})}})},fail:function(){uni.showModal({title:"提示",content:"蓝牙初始化失败，请打开蓝牙"})}})},stopSearch:function(){var t=this;uni.stopBluetoothDevicesDiscovery({success:function(i){t.isSearching=!1,e.log("stop:",i)},fail:function(i){e.log("stop:",i),t.errorCodeTip(i.errCode)}})},checkPemission:function(){var e=this.Bluetooth.BLEInformation;e.platform;this.getBluetoothDevices()},getBluetoothDevices:function(){var t=this;t.list=[],uni.startBluetoothDevicesDiscovery({success:function(i){plus.bluetooth.onBluetoothDeviceFound((function(i){e.log("onBluetoothDeviceFound:",i);for(var n=t.list,o=[],a=i.devices,c=function(e){if(a[e].name&&"未知设备"!=a[e].name){var t=n.filter((function(t){return t.deviceId==a[e].deviceId}));0==t.length&&o.push(a[e])}},r=0;r<a.length;++r)c(r);t.list=n.concat(o)})),t.time=setTimeout((function(){plus.bluetooth.getBluetoothDevices({success:function(i){for(var n=[],o=i.devices,a=0;a<o.length;++a)o[a].name&&"未知设备"!=o[a].name&&n.push(o[a]);t.list=n,e.log("getBluetoothDevices:",i)}}),clearTimeout(t.time)}),3e3)}})},bindViewTap:function(t){e.log("点击蓝牙信息",t);var i=this,n=t.currentTarget.dataset.title,o=i.Bluetooth.BLEInformation;uni.setStorageSync("deviceName",t.currentTarget.dataset.name),this.stopSearch(),i.serviceId=0,i.writeCharacter=!1,i.readCharacter=!1,i.notifyCharacter=!1,uni.showLoading({title:"正在连接"}),e.log("deviceId:",n),setTimeout((function(){plus.bluetooth.createBLEConnection({deviceId:n,success:function(t){e.log("createBLEConnection success:",t),o.deviceId=n,e.log("BLEInformation success:",o),uni.setStorageSync("BLEInformationSet",o),uni.hideLoading(),i.getSeviceId()},fail:function(t){e.log("连接失败",t),i.errorCodeTip(t.errCode),uni.hideLoading()}})}),1e3)},getSeviceId:function(){var t=this,i=t.Bluetooth.BLEInformation;e.log("BLEInformation.deviceId:",i.deviceId),setTimeout((function(){plus.bluetooth.getBLEDeviceServices({deviceId:i.deviceId,success:function(i){e.log("getBLEDeviceServices success:",i),t.services=i.services,t.getCharacteristics()},fail:function(i){e.log("连接失败",i),t.secondGetSeciveId?setTimeout((function(){t.getSeviceId(),t.secondGetSeciveId=!1}),500):t.errorCodeTip(i.code),e.log("getBLEDeviceServices fail:",i)}})}),1e3)},getCharacteristics:function(){e.log("~~~~~~list",i),e.log("~~~~~~services",services);var t=this,i=t.services,n=t.serviceId,o=t.writeCharacter,a=t.readCharacter,c=t.notifyCharacter,r=t.Bluetooth.BLEInformation;plus.bluetooth.getBLEDeviceCharacteristics({deviceId:r.deviceId,serviceId:i[n].uuid,success:function(e){for(var s=0;s<e.characteristics.length;++s){var u=e.characteristics[s].properties,l=e.characteristics[s].uuid;c||u.notify&&(r.notifyCharaterId=l,r.notifyServiceId=i[n].uuid,t.$store.commit("BLEInformationSet",r),uni.setStorageSync("BLEInformationSet",r),c=!0),o||u.write&&(r.writeCharaterId=l,r.writeServiceId=i[n].uuid,t.$store.commit("BLEInformationSet",r),uni.setStorageSync("BLEInformationSet",r),o=!0),a||u.read&&(r.readCharaterId=l,r.readServiceId=i[n].uuid,t.$store.commit("BLEInformationSet",r),uni.setStorageSync("BLEInformationSet",r),a=!0)}o&&c&&a?t.openControl():(n++,t.writeCharacter=o,t.readCharacter=a,t.notifyCharacter=c,t.serviceId=n,n==i.length?uni.showModal({title:"提示",content:"找不到该读写的特征值"}):t.getCharacteristics())},fail:function(i){e.log("getBLEDeviceCharacteristics fail：",i),t.errorCodeTip(i.errCode)}})},openControl:function(){uni.navigateBack({delta:1})}}};t.default=o}).call(this,i("ba7c")["default"])},b644:function(e,t,i){"use strict";var n=i("b945"),o=i.n(n);o.a},b945:function(e,t,i){var n=i("e787");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var o=i("967d").default;o("ec135c54",n,!0,{sourceMap:!1,shadowMode:!1})},e787:function(e,t,i){var n=i("c86c");t=n(!1),t.push([e.i,".btn[data-v-022058a8]{margin-top:%?50?%;height:40px;width:%?600?%;line-height:40px}.sure[data-v-022058a8]{background:#ffb822!important}.item[data-v-022058a8]{display:block;font-family:Arial,Helvetica,sans-serif;font-size:14px;margin:0 30px;margin-top:10px;background-color:grey;border-radius:5px;border-bottom:2px solid #68baea}.block[data-v-022058a8]{color:#fff;display:flex;height:%?100?%;align-items:center;justify-content:center}",""]),e.exports=t}}]);