(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-index-onSiteInstall-installSignOut"],{"1fc9":function(t,i,a){"use strict";var e=a("4a22"),n=a.n(e);n.a},2805:function(t,i,a){"use strict";a.r(i);var e=a("84f2"),n=a("973a");for(var l in n)["default"].indexOf(l)<0&&function(t){a.d(i,t,(function(){return n[t]}))}(l);a("1fc9");var s=a("828b"),o=Object(s["a"])(n["default"],e["b"],e["c"],!1,null,"bd59fc92",null,!1,e["a"],void 0);i["default"]=o.exports},"2a90":function(t,i,a){t.exports=a.p+"static/img/none.png"},"30a6":function(t,i,a){"use strict";a("6a54");var e=a("f5bd").default;Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n=e(a("9b1b")),l=e(a("2634")),s=e(a("2fdc"));a("fd3c"),a("64aa"),a("aa9c"),a("dd2b"),a("bf0f"),a("2797"),a("c223");var o=e(a("eaf4")),u=e(a("fd6d")),d={name:"installSignOut",data:function(){return{installMain:null,mallInstallDetailList:[]}},onLoad:function(t){t.installId?this.getInstalledDetail(t.installId):(uni.showToast({title:"数据有误，重新尝试",icon:"none",duration:1e3}),this.goBack())},methods:{getInstalledDetail:function(t){var i=this;u.default.getInstallById({id:t}).then((function(t){t.meta.success?(i.installMain=t.data.installMain,i.mallInstallDetailList=t.data.installMain.mallInstallDetailList.length?t.data.installMain.mallInstallDetailList.map((function(t){return Object.assign({},t,{isInstall:1,imageList:[],uploadFileIdList:[],reason:""})})):[]):uni.showToast({title:t.meta.message,icon:"none",duration:1e3})}))},changeState:function(t,i,a){var e="isInstall"==i?Number(t.detail.value):t.detail.value;this.$set(this.mallInstallDetailList[a],i,e)},chooseImage:function(t,i){var a=this;return(0,s.default)((0,l.default)().mark((function e(){var n,s;return(0,l.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=t.imageList,s=t.uploadFileIdList,uni.chooseImage({sourceType:["album","camera"],sizeType:["original"],count:1,success:function(e){uni.showLoading({title:"图片上传中"}),uni.uploadFile({url:o.default.server+"api/basicData/installImg/upload?installDetailId="+t.id,filePath:e.tempFilePaths[0],name:"filename",header:{"X-Token":uni.getStorageSync("Token"),"X-User":uni.getStorageSync("User")},success:function(t){uni.hideLoading();var e=JSON.parse(t.data);n.push(e.data.uploadFile.path),s.push(e.data.uploadFile.id),a.$set(a.mallInstallDetailList[i],"imageList",n),a.$set(a.mallInstallDetailList[i],"uploadFileIdList",s)},fail:function(t){uni.hideLoading()}})},fail:function(t){}});case 2:case"end":return e.stop()}}),e)})))()},deleteImage:function(t,i){t.imageList.splice(i,1),t.uploadFileIdList.splice(i,1)},previewImage:function(t,i){uni.previewImage({current:t,urls:i})},submitSingnOut:function(){var t=[];if(this.mallInstallDetailList.forEach((function(i,a){i.reason&&i.imageList.length||t.push(a+1)})),t.length){var i=t.join(",");uni.showToast({title:"请在".concat(i,"项上传图片以及填写备注"),icon:"none",duration:1e3})}else this.singnOut()},singnOut:function(){var t=this;this.$refs.position.startPositioning((function(i){var a=i.province+i.city+i.addr;t.mallInstallDetailList.forEach((function(t){return delete t.imageList}));var e=(0,n.default)((0,n.default)({},t.installMain),{},{mallInstallDetailList:t.mallInstallDetailList,singnOutCoordinate:"".concat(i.lng,",").concat(i.lat),singnOutAddress:a});u.default.singnOut(e).then((function(t){t.meta.success?(uni.showToast({title:"签退成功",icon:"none",duration:1e3}),setTimeout((function(){uni.redirectTo({url:"./installRecord"})}),1e3)):uni.showToast({title:t.meta.message,icon:"none",duration:1e3})}))}))},goBack:function(){uni.navigateBack({delta:1})}}};i.default=d},3687:function(t,i){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAACxklEQVRIS8WXzVLTUBTH/4ekJmEQkKkgosKAduHehQ/guNGVC3wFdWTGJxCfwBFHeQVZuHLluJeFexcoDFWrUKsCQpOQpMc5oem06c0HTofeXXvv//zuPfd83BByDGYu1OvBTY34BgPXGJgjYFSkDOwQsE7Ah4Dp3eCg9paIvCyzlLaAmUccx38EpgcAF7OMHc1TDcQvTFN/SkS7SZpEsOv680HASwSM5wN2rmKgqmm0YBj6ikrfBWZmzXGC52C+9z/ALg3RsmlqD4koaJ/rAAvUtf0VBu70BNo0QsBrw9Ln2+EdYNv2X/bspPGdEy1bln4/+rsFljttBPyqlyeN2xrQ6G505yFYote2/TVVIHmeB13XQZSaAC0GM8P3fRQKha4zSMBZll6SaA+tuXaw2ODG4/jK7eoP1GpVmIaJ6em5cANpQ4Dl8joc10GxOI6J8cnu5YQnllVYJCkOjh18V+Xp+sYaHMcOxYZhYGb6ciJcoJvlz3BdN1xvmhbmZkuKfVLNtLTzdHDg3xogfqM6yd7eLr5+22xNJcHjUBFcvDCD4eERpYMaTLfJqXvPGFhIcuHO7h9UKl8S4Sro1NQljI6cSbwVApbIrnvvAVxPu7skuGja3Su/s6BNzirV6952nrKogoeB2bzTY0ClsVTlxBINp/Lkbxzersl50khyeCywqH79rmFrq9Kxz8lzUxgby9m8jpSHuV0tq1WBlCfV4t6MXJ0ZXGnQyGhWnsfgq5nplASVO5WRlmpJcROmU1oBSYNGeZqV5yp4WEDSSqYU/A0pm67T0quiNw6X2j47W0poLM2SKRZt21sEo6tJSGda+/QxFRpNxuGlK1eVHQpRkxBhWluUDrW//xdnixOJtTeCS23/WdvG0NBpZWfqaotHFagPD4Fox315+jRd3p/HXgQ/8edte86d+IO+Hd6XT5jYBnr+0fYPIzrASGVx0+UAAAAASUVORK5CYII="},"37b9":function(t,i){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAJ1BMVEX///8zMzP6+vpwcHCSkpJ9fX2IiIhISEjY2Njt7e2/v787OztbW1vTET4fAAAAk0lEQVQ4y82TuQ2EQBAEVwgkDq/FY584FwciIATIAEIgCgwCwMEhBEK4zEigy98xt1Wz8/SEEHsUCwh3BcCj0b0nh7yQP/KpdgI2NRY4JVvth4BLmizwV22BDoCkV/11wk8abKZZpQUyAlYAUgJQwFT8OZbLDeJIcIihpbHjoni1aAa2DxqOLRrI1HgGfDh8avHEC/ZBGXwrpcb3AAAAAElFTkSuQmCC"},"4a22":function(t,i,a){var e=a("e850");e.__esModule&&(e=e.default),"string"===typeof e&&(e=[[t.i,e,""]]),e.locals&&(t.exports=e.locals);var n=a("967d").default;n("0fb67a82",e,!0,{sourceMap:!1,shadowMode:!1})},"84f2":function(t,i,a){"use strict";a.d(i,"b",(function(){return e})),a.d(i,"c",(function(){return n})),a.d(i,"a",(function(){}));var e=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("v-uni-view",[e("tx-map-position",{ref:"position"}),e("v-uni-view",{staticClass:"fixed_box"},[e("v-uni-view",{staticClass:"head"},[e("v-uni-view",{staticClass:"header-left"},[e("v-uni-image",{attrs:{src:a("37b9"),mode:""},on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.goBack.apply(void 0,arguments)}}})],1),e("v-uni-view",{staticClass:"header-middle"},[e("v-uni-text",[t._v("安装签退")])],1),e("v-uni-view",{staticClass:"header-right"})],1)],1),t.installMain?e("v-uni-view",{staticClass:"product-main"},[e("v-uni-view",{staticClass:"item"},[e("v-uni-view",{staticClass:"item-lef"},[t._v("安装单号:")]),e("v-uni-view",{},[e("v-uni-view",[t._v(t._s(t.installMain.installNo))])],1)],1),e("v-uni-view",{staticClass:"item"},[e("v-uni-view",{staticClass:"item-lef"},[t._v("客户名称:")]),e("v-uni-view",{},[e("v-uni-view",[t._v(t._s(t.installMain.khName))])],1)],1),t.mallInstallDetailList.length?e("v-uni-view",t._l(t.mallInstallDetailList,(function(i,n){return e("v-uni-view",{key:i.id,staticClass:"item-box"},[e("v-uni-view",{staticClass:"item"},[e("v-uni-view",{staticClass:"item-lef"},[i.picture?e("v-uni-image",{attrs:{src:i.picture}}):e("v-uni-image",{attrs:{src:a("2a90")}})],1),e("v-uni-view",{staticClass:"item-rig"},[e("v-uni-view",{staticClass:"item-flex"},[e("v-uni-text",[t._v("商品名称：")]),e("v-uni-view",[t._v(t._s(i.goodsName))])],1),e("v-uni-view",{staticClass:"item-flex"},[e("v-uni-text",[t._v("商品编号：")]),e("v-uni-view",[t._v(t._s(i.goodsCode))])],1),e("v-uni-view",{staticClass:"item-flex"},[e("v-uni-text",[t._v("商品条码：")]),e("v-uni-view",[t._v(t._s(i.barCode))])],1),e("v-uni-view",{staticClass:"item-flex"},[e("v-uni-text",[t._v("规格数量：")]),e("v-uni-view",[t._v(t._s(i.quantity)+t._s(i.smallUnit))])],1),e("v-uni-view",{staticClass:"item-flex"},[e("v-uni-text",[t._v("总金额：")]),e("v-uni-view",[t._v("￥"+t._s(i.totalmoney))])],1)],1)],1),e("v-uni-view",{staticClass:"install-box"},[e("v-uni-view",[t._v("安装状态")]),e("v-uni-switch",{staticClass:"switch",attrs:{checked:Boolean(i.isInstall)},on:{change:function(i){arguments[0]=i=t.$handleEvent(i),t.changeState(i,"isInstall",n)}}})],1),e("v-uni-view",[e("v-uni-view",{staticClass:"uni-uploader-body"},[e("v-uni-view",[t._v("上传图片：")]),e("v-uni-view",{staticClass:"uni-uploader__files"},[t._l(i.imageList,(function(n,l){return[e("v-uni-view",{key:l+"_0",staticClass:"uni-uploader__file"},[e("v-uni-image",{staticClass:"del-btn",attrs:{src:a("3687"),alt:""},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.deleteImage(i,l)}}}),e("v-uni-image",{staticClass:"uni-uploader__img",attrs:{src:n,"data-src":n},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.previewImage(n,i.imageList)}}})],1)]})),i.imageList.length<4?e("v-uni-view",{staticClass:"uni-uploader__input-box"},[e("v-uni-view",{staticClass:"uni-uploader__input",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.chooseImage(i,n)}}})],1):t._e()],2)],1),e("v-uni-view",{staticClass:"uni-uploader-body"},[e("v-uni-view",[t._v("安装备注：")]),e("v-uni-textarea",{staticClass:"textarea",attrs:{placeholder:"请输入内容",maxlength:"1000"},model:{value:i.reason,callback:function(a){t.$set(i,"reason",a)},expression:"item.reason"}})],1)],1)],1)})),1):t._e()],1):t._e(),e("v-uni-view",{staticClass:"footer",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.submitSingnOut.apply(void 0,arguments)}}},[t._v("保存")])],1)},n=[]},"973a":function(t,i,a){"use strict";a.r(i);var e=a("30a6"),n=a.n(e);for(var l in e)["default"].indexOf(l)<0&&function(t){a.d(i,t,(function(){return e[t]}))}(l);i["default"]=n.a},e850:function(t,i,a){var e=a("c86c");i=e(!1),i.push([t.i,'.fixed_box[data-v-bd59fc92]{position:fixed;z-index:9}.head[data-v-bd59fc92]{display:flex;justify-content:space-between;font-weight:590}.head .header-left[data-v-bd59fc92]{width:20%}.head .header-middle[data-v-bd59fc92]{width:20%}.head .header-right[data-v-bd59fc92]{display:flex;width:20%;justify-content:flex-end}.head uni-image[data-v-bd59fc92]{width:%?48?%;height:%?48?%;margin:%?7?% %?15?%;display:block}.product-main[data-v-bd59fc92]{padding:%?140?% %?20?% %?80?%;font-size:%?30?%}.item-box[data-v-bd59fc92]{border-bottom:%?4?% solid #f7f7f7;padding:%?20?%}.item[data-v-bd59fc92]{display:flex;align-items:center}.item .item-lef[data-v-bd59fc92]{width:%?130?%}.item .item-lef uni-image[data-v-bd59fc92]{width:%?130?%;height:%?130?%}.item .item-rig[data-v-bd59fc92]{flex:1;margin-left:%?20?%;font-size:%?24?%;color:grey}.item .item-flex[data-v-bd59fc92]{display:flex}.install-box[data-v-bd59fc92]{display:flex;align-items:center;margin-top:%?20?%}.install-box .switch[data-v-bd59fc92]{margin-left:%?60?%;zoom:.7}.install-box .switch .uni-switch-input[data-v-bd59fc92]:before{background-color:red}.uni-uploader-body[data-v-bd59fc92]{margin-top:%?16?%}.uni-uploader-body .uni-uploader__files[data-v-bd59fc92]{display:flex;flex-direction:row;flex-wrap:wrap}.uni-uploader-body .uni-uploader__file[data-v-bd59fc92]{margin:%?15?%;width:%?134?%;height:%?134?%;position:relative}.uni-uploader-body .del-btn[data-v-bd59fc92]{position:absolute;top:%?-18?%;right:%?-18?%;z-index:1;width:%?40?%;height:%?40?%}.uni-uploader-body .uni-uploader__img[data-v-bd59fc92]{position:relative;display:inline-block;width:%?134?%;height:%?134?%}.uni-uploader-body .uni-uploader__input-box[data-v-bd59fc92]{position:relative;margin:%?10?%;width:%?134?%;height:%?134?%;border:%?1?% dashed #d9d9d9}.uni-uploader-body .uni-uploader__input-box[data-v-bd59fc92]:before,\n.uni-uploader-body .uni-uploader__input-box[data-v-bd59fc92]:after{content:" ";position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);background-color:#d9d9d9}.uni-uploader-body .uni-uploader__input-box[data-v-bd59fc92]:before{width:%?4?%;height:%?40?%}.uni-uploader-body .uni-uploader__input-box[data-v-bd59fc92]:after{width:%?40?%;height:%?4?%}.uni-uploader-body .uni-uploader__input-box[data-v-bd59fc92]:active{border-color:#999}.uni-uploader-body .uni-uploader__input-box[data-v-bd59fc92]:active:before,\n.uni-uploader-body .uni-uploader__input-box[data-v-bd59fc92]:active:after{background-color:#999}.uni-uploader-body .uni-uploader__input[data-v-bd59fc92]{position:absolute;z-index:100;top:0;left:0;width:100%;height:100%;opacity:0}.uni-uploader-body .textarea[data-v-bd59fc92]{margin-top:%?10?%;border:1px solid #d9d9d9;width:100%;padding:%?10?%}.footer[data-v-bd59fc92]{position:fixed;bottom:0;width:100vw;text-align:center;background:#ffc235;font-size:%?30?%;text-align:center;padding:%?20?% 0;color:#fff}',""]),t.exports=i},fd6d:function(t,i,a){"use strict";var e=a("d4d7"),n={installedCurrently:function(t){return(0,e.get)("api/appInstall/installedCurrently",t,5)},installedCurrentlyDetail:function(t){return(0,e.get)("api/appInstall/installedCurrentlyDetail",t,5)},singnInCheck:function(t){return(0,e.get)("api/appInstall/singnInCheck",t,5)},singnIn:function(t){return(0,e.post)("api/appInstall/singnIn",t,5)},singnOut:function(t){return(0,e.post)("api/appInstall/singnOut",t,5)},getInstallById:function(t){return(0,e.get)("api/appInstall/getInstallById",t,5)},getInstallRecord:function(t){return(0,e.get)("api/appInstall/InstallRecord",t,5)},getInstalledDetail:function(t){return(0,e.get)("api/appInstall/installedDetail",t,5)}};t.exports=n}}]);