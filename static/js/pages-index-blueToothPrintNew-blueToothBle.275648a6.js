(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-index-blueToothPrintNew-blueToothBle"],{3387:function(e,t,o){"use strict";o.d(t,"b",(function(){return i})),o.d(t,"c",(function(){return n})),o.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("v-uni-view",{staticClass:"contain blueTooth"},[o("v-uni-view",{staticClass:"button-parent"},[o("v-uni-view",[e._v("已连接设备")]),o("v-uni-view",{staticClass:"after clear",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.clearConnent()}}},[e._v("清除连接")])],1),o("v-uni-view",{staticClass:"connented blueToothOptins",staticStyle:{"margin-top":"30upx",height:"max-content"}},[e.currDev?o("v-uni-view",{staticClass:"blueCon"},[o("v-uni-text",{staticClass:"blueCon-name"},[e._v(e._s(e.currDev.name))]),o("v-uni-text",{staticClass:"blueCon-deviceId"},[e._v(e._s(e.currDev.deviceId))])],1):e._e()],1),o("v-uni-view",{staticClass:"button-parent"},[o("v-uni-view",[e._v("待连接设备")])],1),o("v-uni-view",{staticClass:"unconnented ",staticStyle:{"margin-top":"30upx"}},[o("v-uni-view",{staticClass:"blueToothOptins"},e._l(e.devices,(function(t,i){return o("v-uni-view",{key:i,staticClass:"blueCon",on:{click:function(o){arguments[0]=o=e.$handleEvent(o),e.onConn(t)}}},[o("v-uni-text",{staticClass:"blueCon-name"},[e._v(e._s(t.name))]),o("v-uni-text",{staticClass:"blueCon-deviceId"},[e._v(e._s(t.deviceId))])],1)})),1)],1),o("v-uni-view",{staticClass:"button-parent"},[o("v-uni-view",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.refresh.apply(void 0,arguments)}}},[e._v("刷新")]),o("v-uni-view",{staticClass:"after",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.goBack()}}},[e._v("返回")])],1)],1)},n=[]},9654:function(e,t,o){"use strict";var i=o("9e3b"),n=o.n(i);n.a},"9d98":function(e,t,o){"use strict";o.r(t);var i=o("3387"),n=o("dad5");for(var a in n)["default"].indexOf(a)<0&&function(e){o.d(t,e,(function(){return n[e]}))}(a);o("9654");var c=o("828b"),r=Object(c["a"])(n["default"],i["b"],i["c"],!1,null,"5b01b963",null,!1,i["a"],void 0);t["default"]=r.exports},"9e3b":function(e,t,o){var i=o("d959");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var n=o("967d").default;n("0c3b2f80",i,!0,{sourceMap:!1,shadowMode:!1})},d959:function(e,t,o){var i=o("c86c");t=i(!1),t.push([e.i,".blueTooth[data-v-5b01b963]{height:100%;display:flex;flex-direction:column}.blueTooth .button-parent[data-v-5b01b963]{display:flex;justify-content:space-between;border:%?1?% solid #ccc;border-left:0;border-right:0;flex:auto;max-height:%?80?%}.blueTooth .button-parent uni-view[data-v-5b01b963]{height:%?80?%;width:50%;display:flex;align-items:center;justify-content:center;color:#2a98d8}.blueTooth .button-parent uni-view.after[data-v-5b01b963]{border-left:solid %?1?% #ccc}.blueTooth .button-parent .clear[data-v-5b01b963]{color:red}.blueTooth .button-parent .ls-loading[data-v-5b01b963]{display:flex}.blueTooth .connented[data-v-5b01b963]{flex:auto;max-height:%?250?%}.blueTooth .unconnented[data-v-5b01b963]{flex:1;flex-basis:%?400?%;overflow:auto}.blueTooth .tips[data-v-5b01b963]{font-size:%?30?%}.blueTooth .blueToothOptins[data-v-5b01b963]{display:flex;flex-direction:row;justify-content:space-around;flex-wrap:wrap;padding-left:%?30?%;padding-right:%?30?%}.blueTooth .blueToothOptins .blueConHidden[data-v-5b01b963]{width:%?255?%;height:%?114?%}.blueTooth .blueToothOptins .blueCon[data-v-5b01b963]{display:flex;flex-direction:column;justify-content:center;align-items:center;width:%?255?%;height:%?114?%;padding:0 %?10?%;margin-bottom:%?20?%;border-radius:%?10?%;border-top-color:#000;border-top-style:solid;border-top-width:1px;border-right-color:#000;border-right-style:solid;border-right-width:1px;border-bottom-color:#000;border-bottom-style:solid;border-bottom-width:1px;border-left-color:#000;border-left-style:solid;border-left-width:1px}.blueTooth .blueToothOptins .blueConActive[data-v-5b01b963]{background-color:#73b9a2;border-top-color:#73b9a2;border-right-color:#73b9a2;border-bottom-color:#73b9a2;border-left-color:#73b9a2}.blueTooth .blueToothOptins .blueCon-nameActive[data-v-5b01b963]{color:#fff!important}.blueTooth .blueToothOptins .blueCon-name[data-v-5b01b963]{font-size:%?26?%;word-break:break-all}.blueTooth .blueToothOptins .blueCon-deviceId[data-v-5b01b963]{font-size:%?18?%}.blueTooth .blueToothOptins .blueCon-deviceIdActive[data-v-5b01b963]{color:#fff!important}.blueTooth .mask-parent[data-v-5b01b963]{position:fixed;top:0;right:0;bottom:0;left:0;display:flex;flex-direction:row;align-items:center;justify-content:center;z-index:1000}.blueTooth .tips-mask[data-v-5b01b963]{position:absolute;top:0;right:0;bottom:0;left:0;background-color:#000;opacity:.3;z-index:1000}.blueTooth .tips-modal[data-v-5b01b963]{z-index:1001;width:%?600?%;height:%?845?%;background-color:#fff;border-radius:%?10?%;display:flex;flex-direction:column;overflow:hidden}.blueTooth .tips-modal-head[data-v-5b01b963]{height:%?110?%;text-align:center}.blueTooth .tips-modal-head-text[data-v-5b01b963]{line-height:%?110?%;font-size:%?32?%;text-align:center}.blueTooth .tips-modal-body[data-v-5b01b963]{flex:1;overflow:hidden;z-index:1001}.blueTooth .tips-modal-foot[data-v-5b01b963]{display:flex;flex-direction:row;align-items:center;height:%?100?%;border-top:1px solid #ddd}.blueTooth .tips-modal-foot-text[data-v-5b01b963]{flex:1;line-height:%?100?%;font-size:%?32?%;text-align:center}.blueTooth .tips-modal-foot-line[data-v-5b01b963]{width:1px;height:%?100?%;background-color:#ddd}",""]),e.exports=t},dad5:function(e,t,o){"use strict";o.r(t);var i=o("edca"),n=o.n(i);for(var a in i)["default"].indexOf(a)<0&&function(e){o.d(t,e,(function(){return i[e]}))}(a);t["default"]=n.a},edca:function(e,t,o){"use strict";(function(e){o("6a54"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,o("d4b5"),o("aa9c");var i={components:{},data:function(){return{devices:[],currDev:null,connId:"",piaojuText:"",msg:"",devicesMap:{}}},watch:{msg:function(){uni.showToast({title:this.msg})},currDev:function(){this.currDev&&uni.setStorageSync("deviceId",this.currDev.deviceId)}},onLoad:function(){var e=this,t=!1;if("android"==uni.getSystemInfoSync().platform){var o=plus.android.importClass("android.content.Context"),i=plus.android.importClass("android.location.LocationManager"),n=plus.android.runtimeMainActivity(),a=n.getSystemService(o.LOCATION_SERVICE);t=a.isProviderEnabled(i.GPS_PROVIDER),!1===t&&uni.showModal({title:"提示",content:"请打开定位服务",success:function(t){var o=t.confirm,i=t.cancel;if(o){var n=plus.android.importClass("android.content.Intent"),a=plus.android.importClass("android.provider.Settings"),c=new n(a.ACTION_LOCATION_SOURCE_SETTINGS),r=plus.android.runtimeMainActivity();r.startActivity(c)}i&&e.goBack()}})}},mounted:function(){this.currDev=uni.getStorageSync("bluetoothObj"),this.connId=uni.getStorageSync("deviceId"),this.searchBle()},destroyed:function(){e.log("destroyed----------"),this.stopFindBule()},methods:{refresh:function(){var e=this;uni.closeBluetoothAdapter({success:function(e){},fail:function(e){},complete:function(t){e.searchBle()}})},searchBle:function(){var t=this;this.devicesMap={},this.devices=[],e.log("initBule"),uni.openBluetoothAdapter({success:function(o){e.log("打开 蓝牙模块"),e.log(o),t.onDevice(),uni.getBluetoothAdapterState({success:function(o){e.log(o),o.available?(o.discovering&&t.stopFindBule(),e.log("开始搜寻附近的蓝牙外围设备"),uni.startBluetoothDevicesDiscovery({success:function(t){e.log(t)}})):e.log("本机蓝牙不可用")}})},fail:function(e){uni.showToast({title:"蓝牙未开启",icon:"none",duration:2e3})}})},onDevice:function(){e.log("监听寻找到新设备的事件---------------");var t=this;uni.onBluetoothDeviceFound((function(o){e.log("--------------new-----------------------"+JSON.stringify(o));var i=JSON.parse(JSON.stringify(o));e.log(i.devices[0].name+"  "+i.devices[0].deviceId);var n=i.devices[0].name;if("未知设备"!=n&&""!=n){var a=i.devices[0].deviceId;t.devicesMap[n]||(t.devices.push({name:n,deviceId:a,services:[]}),t.devicesMap[n]=!0)}}))},stopFindBule:function(){e.log("停止搜寻附近的蓝牙外围设备---------------");uni.stopBluetoothDevicesDiscovery({success:function(t){e.log(t)}})},onConn:function(e,t){var o=this;e.deviceId!=o.connId?o._onConn(e):uni.closeBLEConnection({deviceId:o.connId,success:function(e){t&&(o.msg="连接已清除")},complete:function(t){o._onConn(e)}})},_onConn:function(t){var o=this;e.log("连接蓝牙---------------"+t.deviceId),uni.showLoading({title:"连接中",mask:!0});var i=t.deviceId;uni.createBLEConnection({deviceId:i,complete:function(t){"createBLEConnection:ok"==t.errMsg?(o.connId=i,setTimeout((function(){o.getBLEServices(i)}),2e3)):e.log("error",t),o.stopFindBule()}})},getBLEServices:function(t){var o=this,i=t;e.log("获取蓝牙设备所有服务(service)。---------------"),uni.getBLEDeviceServices({deviceId:i,complete:function(t){if(!t.services&&10004==t.errCode)return uni.showToast({title:"连接失败",icon:"error",duration:2e3,mask:!0}),o.clearConnent(!1),void uni.hideLoading();for(var n=function(n){e.error(t.services[n].uuid);var a=t.services[n].uuid,c=t.services.length;uni.getBLEDeviceCharacteristics({deviceId:i,serviceId:a,success:function(e){for(var t=JSON.parse(JSON.stringify(e)),r=0;r<t.characteristics.length;r++)if(1==t.characteristics[r].properties.write){var s=t.characteristics[r].uuid,d=!1;for(var l in o.devices)if(o.devices[l].deviceId==i){o.devices[l].services.push({serviceId:a,characteristicId:s}),o.currDev=o.devices[l],uni.setStorageSync("bluetoothObj",o.devices[l]),uni.setStorageSync("nLastBluetooth",o.devices[l]),d=!0;break}if(d)break}n==c-1&&(uni.showToast({title:"连接成功",icon:"success",duration:1e3,mask:!0}),setTimeout((function(){o.goBack()}),1e3))},fail:function(){uni.hideLoading(),uni.showToast({title:"连接失败",icon:"error",duration:2e3,mask:!0})}})},a=0;a<t.services.length;a++)n(a)}})},clearConnent:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,o=this;""!=this.connId&&uni.closeBLEConnection({deviceId:o.connId,success:function(t){e&&(o.msg="连接已清除")},complete:function(e){o.searchBle(),t&&t()}}),o.currDev=null,uni.setStorageSync("bluetoothObj",null)},goBack:function(){uni.navigateBack({delta:1})}}};t.default=i}).call(this,o("ba7c")["default"])}}]);