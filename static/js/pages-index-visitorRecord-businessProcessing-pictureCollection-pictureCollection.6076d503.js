(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-index-visitorRecord-businessProcessing-pictureCollection-pictureCollection"],{"2c7e":function(i,e,t){"use strict";(function(i){t("6a54");var a=t("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t("bf0f"),t("aa9c"),t("d4b5"),t("c9b5"),t("ab80"),t("dd2b"),t("fd3c"),t("e966");var n=a(t("9b1b")),d=a(t("2634")),o=a(t("2fdc")),c=a(t("7618")),s=a(t("c3c0")),r=a(t("0a06")),l=a(t("eaf4")),u=a(t("2064")),f={components:{ImageWatermark:c.default,classifications:u.default},data:function(){return{imageList:[],visitSignIn:"",option:{},classificationsOption:{}}},mounted:function(){},onLoad:function(e){i.log("options::",e),this.visitSignIn=uni.getStorageSync("visitSignIn")},onShow:function(){this.visitSignIn&&this.visitSignIn.signInId&&this.init()},methods:{init:function(){var e=this;if(e.visitSignIn&&e.visitSignIn.signInId){var t={id:e.visitSignIn.signInId,type:1};r.default.getFxVisitMain(e.visitSignIn.signInId,t).then((function(i){i.meta.success?e.imageList=i.data.visitFiles:uni.showToast({title:i.meta.message,icon:"none",duration:1e3})}))}else i.log("没有签到信息")},chooseImage:function(){var i=(0,o.default)((0,d.default)().mark((function i(){var e,t,a,n;return(0,d.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:e=function(i,t,n){uni.showLoading({title:"图片上传中"}),s.default.uploadFile("/file/upload",t[n],"multipartfile").then((function(e){var t=JSON.parse(e.data);t.meta.success?a.push({visitId:i.visitSignIn.signInId,filesType:0,summary:"",filesName:t.data.name,filesUrl:t.data.sourceUrl}):uni.showToast({title:t.meta.message,icon:"none",duration:1e3})})).finally((function(){n<=t.length?e(i,t,n+1):r.default.fxVisitFilesImgCollection(a).then((function(e){e.meta.success?(i.init(),uni.showToast({title:"上传图片成功",icon:"none",duration:1e3})):uni.showToast({title:e.meta.message,icon:"none",duration:1e3})})).finally((function(){uni.hideLoading()}))}))},t=this,a=JSON.parse(JSON.stringify(t.imageList)),n=[],n=uni.getStorageSync("InterviewAndSaleLocalImage")?["album","camera"]:["camera"],s.default.chooseImage((function(){}),n).then((function(i){uni.getStorageSync("images_watermark")?t.option=i.tempFiles[0]:e(t,i.tempFilePaths,0)}));case 6:case"end":return i.stop()}}),i,this)})));return function(){return i.apply(this,arguments)}}(),delImage:function(i,e){var t=this;if(i.id){var a=[i.id].toString();r.default.fxVisitFilesDelete(a).then((function(i){i.meta.success?(uni.showToast({title:"删除图片成功",icon:"none",duration:1e3}),t.imageList.splice(e,1),t.init()):uni.showToast({title:i.meta.message,icon:"none",duration:1e3})}))}else this.imageList.splice(e,1)},previewImage:function(i){var e=i.target.dataset.src,t=this.imageList.map((function(i){return i.filesUrl}));uni.previewImage({current:e,urls:t})},chooseConfirm:function(){uni.showToast({title:"保存成功",icon:"none",duration:1e3});var i=this;setTimeout((function(){i.chooseCancel()}),1e3)},chooseCancel:function(){uni.navigateBack({delta:1})},confirm:function(i){var e=this,t=.4,a=Math.round(i.detail.size/1024);a<=1024&&(t=1);var n=parseInt(i.detail.width*t),d=parseInt(n*i.detail.height/i.detail.width);uni.compressImage({src:i.detail.tempFilePath,quality:80,width:n+"px",height:d+"px",success:function(i){(function(i){uni.showLoading({title:"图片上传中"}),uni.uploadFile({url:l.default.pdcom+"/file/upload",method:"POST",header:{"X-Token":uni.getStorageSync("Token"),"X-User":uni.getStorageSync("User")},filePath:i,name:"multipartfile",success:function(i){var t=JSON.parse(i.data);if(t.meta.success){var a={visitId:e.visitSignIn.signInId,filesType:0,summary:"",filesName:t.data.name,filesUrl:t.data.sourceUrl};e.imageList.push(a),r.default.fxVisitFilesImgCollection(e.imageList).then((function(i){i.meta.success?(e.init(),uni.showToast({title:"上传图片成功",icon:"none",duration:1e3})):uni.showToast({title:i.meta.message,icon:"none",duration:1e3})})).finally((function(){}))}else uni.showToast({title:t.meta.message,icon:"none",duration:1e3})},fail:function(i){},complete:function(){uni.hideLoading()}})})(i.tempFilePath)}})},cancel:function(){i.log("canceled")},setClassifications:function(i){var e=this;e.classificationsOption={show:!0,change:function(t){e.category(i,t)}}},category:function(i,e){var t=this,a={id:t.imageList[i].id,category:e.id};r.default.category(a).then((function(a){a.meta.success?t.$set(t.imageList,i,(0,n.default)((0,n.default)({},t.imageList[i]),{},{categoryName:e.name})):uni.showToast({title:a.meta.message,icon:"none",duration:1e3})}))}}};e.default=f}).call(this,t("ba7c")["default"])},"6e94":function(i,e,t){"use strict";t.r(e);var a=t("905d"),n=t("ebdf");for(var d in n)["default"].indexOf(d)<0&&function(i){t.d(e,i,(function(){return n[i]}))}(d);t("ad7b");var o=t("828b"),c=Object(o["a"])(n["default"],a["b"],a["c"],!1,null,"de94cfdc",null,!1,a["a"],void 0);e["default"]=c.exports},"905d":function(i,e,t){"use strict";t.d(e,"b",(function(){return n})),t.d(e,"c",(function(){return d})),t.d(e,"a",(function(){return a}));var a={imageWatermark:t("7618").default},n=function(){var i=this,e=i.$createElement,a=i._self._c||e;return a("v-uni-view",[a("image-watermark",{attrs:{option:i.option},on:{confirm:function(e){arguments[0]=e=i.$handleEvent(e),i.confirm.apply(void 0,arguments)},cancel:function(e){arguments[0]=e=i.$handleEvent(e),i.cancel.apply(void 0,arguments)}}}),a("v-uni-view",{staticClass:"img-content"},[a("v-uni-text",[i._v("已上传图片")]),a("v-uni-view",{staticClass:"upload-images"},[a("v-uni-view",{staticClass:"imagelist"},[i._l(i.imageList,(function(e,n){return a("v-uni-view",{key:n,staticClass:"imageitem"},[a("v-uni-view",{staticClass:"uni-uploader__file"},[a("v-uni-image",{staticClass:"img-del",attrs:{src:t("3687")},on:{click:function(t){arguments[0]=t=i.$handleEvent(t),i.delImage(e,n)}}}),a("v-uni-image",{staticClass:"uni-uploader__img",attrs:{src:e.filesUrl,"data-src":e.filesUrl},on:{click:function(e){arguments[0]=e=i.$handleEvent(e),i.previewImage.apply(void 0,arguments)}}})],1),a("v-uni-view",{staticClass:"uni-uploader__classification",on:{click:function(e){arguments[0]=e=i.$handleEvent(e),i.setClassifications(n)}}},[i._v(i._s(e.categoryName?e.categoryName:"设置分类"))])],1)})),a("v-uni-view",{staticClass:"imageitem"},[a("v-uni-view",{staticClass:"uni-uploader__file"},[a("v-uni-view",{staticClass:"add-image align-center",on:{click:function(e){arguments[0]=e=i.$handleEvent(e),i.chooseImage.apply(void 0,arguments)}}},[a("v-uni-image",{attrs:{src:"/static/img/outNote/add.png",mode:""}})],1)],1)],1)],2)],1)],1),a("v-uni-view",{staticClass:"foot-two-buttons"},[a("v-uni-view",{staticClass:"foot-left",on:{click:function(e){arguments[0]=e=i.$handleEvent(e),i.chooseConfirm.apply(void 0,arguments)}}},[a("v-uni-text",[i._v("确认")])],1),a("v-uni-view",{staticClass:"foot-right",on:{click:function(e){arguments[0]=e=i.$handleEvent(e),i.chooseCancel.apply(void 0,arguments)}}},[a("v-uni-text",[i._v("返回")])],1)],1),a("classifications",{attrs:{option:i.classificationsOption}})],1)},d=[]},ad7b:function(i,e,t){"use strict";var a=t("c7fe"),n=t.n(a);n.a},c3e8:function(i,e,t){var a=t("c86c");e=a(!1),e.push([i.i,'@charset "UTF-8";uni-page-body[data-v-de94cfdc]{background:#f6f6f6!important}uni-page-body uni-text[data-v-de94cfdc]{display:inline-block;box-sizing:border-box;padding:0 %?30?%;line-height:%?70?%;font-size:%?32?%}.title[data-v-de94cfdc]{display:inline-block;box-sizing:border-box;width:100%;padding:0 %?30?%;line-height:%?70?%;font-size:%?32?%;background-color:#f6f6f6;border-top:%?2?% solid #e8e8e8;border-bottom:%?2?% solid #e8e8e8}.textareaKuang[data-v-de94cfdc]{padding:%?20?% %?30?%;background:#fff}.uni-textarea[data-v-de94cfdc], .uni-textarea-textarea[data-v-de94cfdc], uni-textarea[data-v-de94cfdc], .upload-images[data-v-de94cfdc], .upload-recording[data-v-de94cfdc]{background:#fff}.uni-textarea-textarea[data-v-de94cfdc], uni-textarea[data-v-de94cfdc]{width:100%!important}uni-textarea[data-v-de94cfdc]{height:%?300?%!important}.upload-images[data-v-de94cfdc]{min-height:%?250?%;padding:0 %?30?%;display:flex;align-items:center}.upload-images uni-image[data-v-de94cfdc]{width:%?150?%;height:%?150?%;margin-right:%?20?%}.upload-images .add-image[data-v-de94cfdc]{width:%?150?%;height:%?150?%;background:#f6f6f6;border:1px dashed #ffb822}.upload-images .add-image uni-image[data-v-de94cfdc]{width:%?80?%;height:%?80?%;margin-right:0}.upload-recording[data-v-de94cfdc]{min-height:%?150?%;border-bottom:%?2?% solid #e8e8e8}.sub-recording[data-v-de94cfdc]{width:%?500?%;position:absolute;-webkit-transform:translateX(-50%);transform:translateX(-50%);left:50%;background:#ccc;margin-top:%?10?%;border-radius:%?36?%;height:%?70?%}.sub-recording[data-v-de94cfdc]:before{content:"按住录音"}.sub-recording uni-image[data-v-de94cfdc]{width:%?50?%;height:%?50?%;position:absolute;left:20%}.sub-recording[data-v-de94cfdc]:active{background:#000;opacity:.5;color:#fff}.sub-recording[data-v-de94cfdc]:active:before{content:"正在录音... "}.upload-images[data-v-de94cfdc]{min-height:%?150?%;padding:%?50?% %?30?%}.imagelist[data-v-de94cfdc]{display:flex;flex-wrap:wrap;width:100%}.imagelist .imageitem[data-v-de94cfdc]{width:25%}.imagelist .imageitem .uni-uploader__file[data-v-de94cfdc]{display:flex;justify-content:center;align-items:center;position:relative;padding:%?10?%}.imagelist .imageitem .uni-uploader__file .img-del[data-v-de94cfdc]{position:absolute;width:%?40?%!important;height:%?40?%!important;margin:0;top:0;left:0;z-index:222}.imagelist .imageitem .uni-uploader__file .uni-uploader__img[data-v-de94cfdc]{margin:0}.imagelist .imageitem .uni-uploader__file .add-image[data-v-de94cfdc]{width:%?146?%;height:%?146?%;margin:0}.imagelist .imageitem .uni-uploader__classification[data-v-de94cfdc]{text-align:center;font-size:28upxpx;color:#c3c3c3;padding:0 %?10?%;margin-bottom:%?20?%}.foot-bootom[data-v-de94cfdc]{height:%?200?%;background:#f6f6f6!important}.upload-recording[data-v-de94cfdc]{padding:%?20?% %?30?%}.upload-recording .recordingitem[data-v-de94cfdc]{border-bottom:%?2?% solid #eee}.upload-recording .recordingitem[data-v-de94cfdc]:last-child{border:0}.upload-recording .recordingitem .uni-recording__file[data-v-de94cfdc]{display:flex;justify-content:space-between;align-items:center;line-height:%?90?%}.upload-recording .recordingitem .uni-recording__file .name[data-v-de94cfdc]{font-size:%?28?%}.upload-recording .recordingitem .uni-recording__file .operation[data-v-de94cfdc]{display:flex;justify-content:space-between;align-items:center}.upload-recording .recordingitem .uni-recording__file .operation .icon[data-v-de94cfdc]{width:%?50?%;height:%?50?%;padding:0 %?12?%}uni-page-body[data-v-de94cfdc]{background-color:#f6f6f6}body.?%PAGE?%[data-v-de94cfdc]{background-color:#f6f6f6}.upRecordName[data-v-de94cfdc]{display:flex;align-items:center}.upRecordName .recordName[data-v-de94cfdc]{display:flex;justify-content:space-between;background:#edebf5;width:%?360?%;height:%?70?%;font-size:%?30?%;border-radius:%?10?%;text-align:left;padding-left:%?20?%}.upRecordName .format[data-v-de94cfdc]{padding-left:%?10?%}.img-content uni-text[data-v-de94cfdc]{display:inline-block;box-sizing:border-box;padding:0 %?30?%;font-size:%?32?%;line-height:%?70?%;width:100%;border-bottom:%?2?% solid #f6f6f6}.upload-images[data-v-de94cfdc]{min-height:%?150?%;padding:%?50?% %?30?%}.imagelist[data-v-de94cfdc]{display:flex;flex-wrap:wrap;width:100%}.imagelist .imageitem[data-v-de94cfdc]{width:25%}.imagelist .imageitem .uni-uploader__file[data-v-de94cfdc]{display:flex;justify-content:center;align-items:center;position:relative;padding:%?10?%}.imagelist .imageitem .uni-uploader__file .img-del[data-v-de94cfdc]{position:absolute;width:%?40?%!important;height:%?40?%!important;margin:0;top:0;left:0;z-index:222}.imagelist .imageitem .uni-uploader__file .uni-uploader__img[data-v-de94cfdc]{margin:0}.imagelist .imageitem .uni-uploader__file .add-image[data-v-de94cfdc]{width:%?146?%;height:%?146?%;margin:0}.imagelist .imageitem .uni-uploader__classification[data-v-de94cfdc]{text-align:center;font-size:28upxpx;color:#c3c3c3;padding:0 %?10?%;margin-bottom:%?20?%}',""]),i.exports=e},c7fe:function(i,e,t){var a=t("c3e8");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[i.i,a,""]]),a.locals&&(i.exports=a.locals);var n=t("967d").default;n("610c648e",a,!0,{sourceMap:!1,shadowMode:!1})},ebdf:function(i,e,t){"use strict";t.r(e);var a=t("2c7e"),n=t.n(a);for(var d in a)["default"].indexOf(d)<0&&function(i){t.d(e,i,(function(){return a[i]}))}(d);e["default"]=n.a}}]);