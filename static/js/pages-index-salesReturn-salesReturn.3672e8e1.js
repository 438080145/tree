(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-index-salesReturn-salesReturn"],{"07a1":function(t,e,i){"use strict";i.r(e);var a=i("1c99"),s=i("7617");for(var n in s)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(n);i("ce7f");var o=i("828b"),r=Object(o["a"])(s["default"],a["b"],a["c"],!1,null,"06fb426f",null,!1,a["a"],void 0);e["default"]=r.exports},"1c99":function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return s})),i.d(e,"a",(function(){}));var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"contain"},[a("v-uni-view",{staticClass:"head"},[a("v-uni-view",{staticClass:"header-left",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.backGo.apply(void 0,arguments)}}},[a("v-uni-image",{attrs:{src:i("37b9"),mode:""}})],1),a("v-uni-view",{staticClass:"header-middle"},[a("v-uni-text",[t._v("销售退货单")])],1),a("v-uni-view",{staticClass:"header-right"},[a("v-uni-image",{attrs:{src:i("5bc3")},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clearAllDate.apply(void 0,arguments)}}}),a("v-uni-image",{attrs:{src:"/static/img/history.png"},on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.toHistory.apply(void 0,arguments)}}}),a("v-uni-image",{staticClass:"header-image",attrs:{src:"/static/img/outNote/setimg.png",mode:"widthFix"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.setHeader.apply(void 0,arguments)}}})],1)],1),a("v-uni-view",{staticClass:"blank"}),a("v-uni-view",{staticClass:"middle"},[a("v-uni-view",{staticClass:"item"},[a("v-uni-view",{staticClass:"middle-des"},[t._v(" 单据日期： ")]),a("v-uni-view",{staticClass:"middle-select"},[a("v-uni-picker",{attrs:{mode:"date",value:t.date,start:t.startDate,end:t.endDate},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.bindDateChange.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"uni-input"},[t._v(t._s(t.date))])],1),a("v-uni-image",{attrs:{src:i("846e"),mode:""}})],1)],1),a("v-uni-view",{staticClass:"item"},[a("v-uni-view",{staticClass:"middle-des"},[t._v(" 客户： ")]),a("v-uni-view",{staticClass:"middle-select",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.customerList.apply(void 0,arguments)}}},[a("v-uni-input",{attrs:{type:"text",placeholder:"点击选择客户"},model:{value:t.customerName,callback:function(e){t.customerName=e},expression:"customerName"}}),a("v-uni-image",{attrs:{src:i("59b8")}})],1)],1),a("v-uni-view",{staticClass:"item"},[a("v-uni-view",{staticClass:"middle-des"},[t._v(" 仓库： ")]),a("v-uni-view",{staticClass:"middle-select",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.warehouseList.apply(void 0,arguments)}}},[a("v-uni-input",{attrs:{type:"text",placeholder:"点击选择仓库"},model:{value:t.storehouseName,callback:function(e){t.storehouseName=e},expression:"storehouseName"}}),a("v-uni-image",{attrs:{src:i("59b8"),mode:""}})],1)],1),t.fieldConfig.remark?a("v-uni-view",{staticClass:"item"},[a("v-uni-view",{staticClass:"middle-des"},[a("span",{directives:[{name:"show",rawName:"v-show",value:t.requireConfig&&t.requireConfig.remark,expression:"requireConfig && requireConfig.remark"}],staticStyle:{color:"red"}},[t._v("*")]),t._v(" 备注： ")]),a("v-uni-view",{staticClass:"middle-select"},[a("v-uni-input",{attrs:{type:"text",placeholder:"输入备注"},on:{confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.remarks.apply(void 0,arguments)},blur:function(e){arguments[0]=e=t.$handleEvent(e),t.remarks.apply(void 0,arguments)}},model:{value:t.remarksVal,callback:function(e){t.remarksVal=e},expression:"remarksVal"}})],1)],1):t._e(),a("v-uni-view",{staticClass:"item"},[a("v-uni-view",{staticClass:"middle-des"},[t._v(" 商品选择： ")]),a("v-uni-view",{staticClass:"middle-select"},[a("v-uni-input",{attrs:{type:"text",placeholder:"商品名称/货号/条码"},on:{confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.search(e)}},model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}}),a("v-uni-text",{on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.commodityList.apply(void 0,arguments)}}},[t._v("添加商品")])],1)],1)],1),a("v-uni-view",{staticClass:"sweepCode"},[a("v-uni-image",{attrs:{src:i("9ec0"),mode:""},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.commodityList.apply(void 0,arguments)}}}),a("v-uni-image",{attrs:{src:i("9796"),mode:""},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.scanning.apply(void 0,arguments)}}})],1),t._l(t.returnsList,(function(e,s){return a("v-uni-view",{key:s,staticClass:"order-item",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.saleDetaEvent(e,s)}}},[a("v-uni-view",{staticClass:"order-item-top"},[a("v-uni-image",{staticClass:"order-item-left",attrs:{src:e.picture,mode:""}}),a("v-uni-view",{staticClass:"order-item-right"},[a("v-uni-view",{staticClass:"order-inside inside-left"},[a("v-uni-view",{staticClass:"order-fir-left"},[t._v(t._s(e.goodsName))]),a("v-uni-view",{staticClass:"order-sec-left"},[t._v("库存："+t._s(e.orderQuantity?e.orderQuantity:0))]),t.useMultUnit?a("v-uni-view",{staticClass:"order-sec-left"},[t._v("规格：1"+t._s(e.specUnit)+"*"+t._s(e.multipleUnitSpecification)+t._s(e.smallUnit))]):a("v-uni-view",{staticClass:"order-sec-left"},[t._v("规格：1"+t._s(e.largeUnit)+"* "+t._s(e.packingSpecification)+t._s(e.smallUnit))])],1),a("v-uni-view",{staticClass:"order-inside inside-right"},[a("v-uni-view",{staticClass:"order-fir-right"},[t._v("￥"+t._s(e.amount?e.amount:0))]),a("v-uni-view",{staticClass:"order-sec-right",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.delectItem(e,s)}}},[t._v("删除")])],1)],1)],1),e.checked?a("v-uni-view",{staticClass:"order-item-bottom"},[t.useMultUnit?a("v-uni-view",{staticClass:"bottom-fir"},[a("v-uni-view",{staticClass:"bottom-input"},[a("v-uni-view",{staticClass:"bottom-des"},[t._v("单价")]),a("v-uni-input",{attrs:{type:"digit",disabled:t.noPriceChangeAllowed,value:e.modePrice?e.modePrice:0},on:{blur:function(e){arguments[0]=e=t.$handleEvent(e),t.priceIP(e,s)},confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.priceIP(e,s)}}})],1),a("v-uni-view",{staticClass:"bottom-input"},[a("v-uni-view",{staticClass:"bottom-des"},[t._v("数量")]),a("v-uni-input",{attrs:{type:"digit",value:e.itemQuantity},on:{blur:function(e){arguments[0]=e=t.$handleEvent(e),t.numberIP(e,s)},confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.numberIP(e,s)}}})],1),a("v-uni-view",{staticClass:"bottom-input"},[a("v-uni-view",{staticClass:"bottom-des"},[t._v("单位")]),a("v-uni-view",{on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.getSelectUnit(s)}}},[t._v(t._s(e.specUnit))])],1),a("v-uni-view",{staticClass:"bottom-input"})],1):a("v-uni-view",{staticClass:"bottom-fir"},[a("v-uni-view",{staticClass:"bottom-input"},[a("v-uni-view",{staticClass:"bottom-des"},[t._v("件价")]),a("v-uni-input",{attrs:{type:"digit",disabled:t.noPriceChangeAllowed,value:e.saleIP},on:{blur:function(e){arguments[0]=e=t.$handleEvent(e),t.priceIP(e,s)},confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.priceIP(e,s)}}})],1),a("v-uni-view",{staticClass:"bottom-input"},[a("v-uni-view",{staticClass:"bottom-des"},[t._v("件数")]),a("v-uni-input",{attrs:{type:"number",value:e.itemQuantity},on:{blur:function(e){arguments[0]=e=t.$handleEvent(e),t.numberIP(e,s)},confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.numberIP(e,s)}}})],1),1!=e.packingSpecification||e.saleIP!=e.saleSP?a("v-uni-view",{staticClass:"bottom-input"},[a("v-uni-view",{staticClass:"bottom-des"},[t._v("散价")]),a("v-uni-input",{attrs:{type:"digit",disabled:t.noPriceChangeAllowed,value:e.saleSP},on:{blur:function(e){arguments[0]=e=t.$handleEvent(e),t.priceSP(e,s)},confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.priceSP(e,s)}}})],1):t._e(),1!=e.packingSpecification||e.saleIP!=e.saleSP?a("v-uni-view",{staticClass:"bottom-input"},[a("v-uni-view",{staticClass:"bottom-des"},[t._v("散数")]),a("v-uni-input",{attrs:{type:"number",value:e.scatteredQuantity},on:{blur:function(e){arguments[0]=e=t.$handleEvent(e),t.numberSP(e,s)},confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.numberSP(e,s)}}})],1):t._e()],1),a("v-uni-view",{staticClass:"bottom-sec"},[a("v-uni-view",{staticClass:"bottom-sec-des"},[t._v("品牌：")]),a("v-uni-view",{staticClass:"bottom-sec-num"},[t._v(t._s(e.brandName))])],1),a("v-uni-view",{staticClass:"bottom-sec"},[a("v-uni-view",{staticClass:"bottom-sec-des"},[t._v("条码：")]),a("v-uni-view",{staticClass:"bottom-sec-num"},[t._v(t._s(e.barCode))])],1),a("v-uni-view",{staticClass:"bottom-sec"},[a("v-uni-view",{staticClass:"bottom-sec-des"},[t._v("型号：")]),a("v-uni-view",{staticClass:"bottom-sec-num"},[t._v(t._s(e.typeSpecification))])],1),a("v-uni-view",{staticClass:"bottom-sec"},[a("v-uni-view",{staticClass:"bottom-sec-des"},[t._v("备注：")]),a("v-uni-input",{staticClass:"bottom-sec-input",attrs:{type:"text",value:e.remark,placeholder:"点击输入备注"},on:{blur:function(e){arguments[0]=e=t.$handleEvent(e),t.goodsremarks(e,s)},confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.goodsremarks(e,s)}}})],1)],1):t._e(),a("v-uni-view",{staticClass:"order-item-foot",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.closeOpen(e,s)}}},[e.checked?a("v-uni-view",{staticClass:"foot-des"},[a("v-uni-view",[t._v("点击收起")]),a("v-uni-image",{staticStyle:{transform:"rotate(180deg)"},attrs:{src:i("4fe6"),mode:""}})],1):a("v-uni-view",{staticClass:"foot-des"},[a("v-uni-view",[t._v("展开更多")]),a("v-uni-image",{attrs:{src:i("4fe6"),mode:""}})],1)],1)],1)})),a("v-uni-view",{staticClass:"blank",staticStyle:{background:"#F6F6F6"}}),a("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:t.orderStat,expression:"orderStat"}],staticClass:"footfixed"},[a("v-uni-view",{staticClass:"foot-bg"},[a("v-uni-view",{staticClass:"foot-bg-left"},[a("v-uni-view",[t._v("金额："),a("v-uni-text",[t._v(t._s(t.total))])],1)],1),a("v-uni-view",{staticClass:"foot-bg-right",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.creatNewDocm.apply(void 0,arguments)}}},[t._v("开单")])],1)],1)],2)},s=[]},"37b9":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAJ1BMVEX///8zMzP6+vpwcHCSkpJ9fX2IiIhISEjY2Njt7e2/v787OztbW1vTET4fAAAAk0lEQVQ4y82TuQ2EQBAEVwgkDq/FY584FwciIATIAEIgCgwCwMEhBEK4zEigy98xt1Wz8/SEEHsUCwh3BcCj0b0nh7yQP/KpdgI2NRY4JVvth4BLmizwV22BDoCkV/11wk8abKZZpQUyAlYAUgJQwFT8OZbLDeJIcIihpbHjoni1aAa2DxqOLRrI1HgGfDh8avHEC/ZBGXwrpcb3AAAAAElFTkSuQmCC"},"4fe6":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAKBAMAAACgUqiRAAAAGFBMVEWEhISAgIBHcEyAgIB6enqAgICCgoKAgIAUaalZAAAAB3RSTlMT0gDXGbcqhO85WQAAAEpJREFUCNdjSGVSAgHXBIZwARBDxTyAgbEQJOhcyMCgIC4AEhJQYFACCToXMgFZQEGgkBKQBRRMBgqDWAri5UClIBZYJYSlEAAiAOZMDmcJUYE4AAAAAElFTkSuQmCC"},5058:function(t,e,i){"use strict";(function(t){i("6a54");var a=i("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("fd3c"),i("c9b5"),i("bf0f"),i("ab80"),i("473f"),i("e838"),i("aa9c"),i("c223"),i("aa77"),i("dd2b"),i("dc8a"),i("2797");var s=a(i("5de6")),n=a(i("9b1b")),o=(a(i("8824")),i("8f59")),r={data:function(){return{date:this.timeShift.getDate({format:!0}),noPriceChangeAllowed:!1,startDate:this.timeShift.getDate("start"),endDate:this.timeShift.getDate("end"),customerName:"",customerId:"",storehouseName:"",storehouseId:"",returnsList:[],orderStat:!1,total:0,employeeId:"",employeeName:"",searchText:"",footFlag:!1,historyprice:"",remarksVal:"",goodsRemark:"",saleBillId:"",saleNo:"",title:"",type:"",customer:{},storehouse:{},institutionsName:"",barCodeKeyword:"",strogeobj:{},fieldConfig:{remark:!1},requireConfig:{},useMultUnit:!1}},methods:(0,n.default)((0,n.default)({},(0,o.mapMutations)(["setparams"])),{},{backGo:function(){uni.navigateBack({delta:1})},enquiryDocuments:function(){var e=this;uni.showLoading({title:"加载中",mask:!0}),this.get("sale/getSaleIdData",{id:this.saleBillId},3).then((function(i){if(i.meta.success){uni.hideLoading(),t.log("res",i);var a=i.data.saleDetailList;e.returnsList=(a||[]).map((function(t){return(0,n.default)((0,n.default)({},t),{},{itemQuantity:t.specUnitQuantity||t.itemQuantity})}));for(var s=0;s<a.length;s++)a[s].picture||(a[s].picture="../../../static/img/outNote/photo.png"),a[s].orderQuantity||(a[s].orderQuantity=0);e.orderStat=!0,e.customerName=i.data.customerName,e.storehouseName=i.data.storehouseName,e.customerId=i.data.customerId,e.storehouseId=i.data.storehouseId,e.remarksVal=i.data.remark?i.data.remark:"",e.saleNo=i.data.saleNo,e.date=e.timeShift.formatDate(i.data.fillDate)||e.timeShift.getDate({format:!0}),uni.setStorageSync("salesReturn",e.returnsList),e.$data.warehouseName=i.data.storehouseName,e.$data.customerName=i.data.customerName,e.$data.ids=i.data.customerId,e.$data.warehouseId=i.data.storehouseId}}))},bindDateChange:function(t){this.date=t.target.value},customerList:function(){this.setparams({searchtype:"customer",filed:"customer"}),uni.navigateTo({url:"../components/toolssearchlist/toolssearchlist"})},warehouseList:function(){this.setparams({searchtype:"storehouse",filed:"storehouse"}),uni.navigateTo({url:"../components/toolssearchlist/toolssearchlist"})},search:function(t){this.customerId?this.storehouseId?(this.inputValue=t.detail.value,this.getCommodity()):uni.showToast({icon:"none",title:"请选择仓库",duration:2e3}):uni.showToast({icon:"none",title:"请选择客户",duration:2e3})},commodityList:function(){t.log("this.customerId",this.customerId),t.log("this.storehouseId",this.storehouseId),this.customerId?this.storehouseId?(this.setparams({khId:this.customerId,storehouseId:this.storehouseId,billtype:"salesReturn",inputValue:""}),uni.navigateTo({url:"../commodityList/commodityList"})):uni.showToast({icon:"none",title:"请选择仓库",duration:2e3}):uni.showToast({icon:"none",title:"请选择客户",duration:2e3})},remarks:function(t){this.remarksVal=t.detail.value,this.strogeobj.remarks=this.remarksVal,uni.setStorageSync("saleReturnNoteTemp",this.strogeobj)},scanning:function(){var e=this;this.customerId?this.storehouseId?uni.scanCode({success:function(i){t.log("条码内容："+i.result),e.barCodeKeyword=i.result.toString(),e.getCommodity(!0)}}):uni.showToast({icon:"none",title:"请选择仓库",duration:2e3}):uni.showToast({icon:"none",title:"请选择客户",duration:2e3})},getCommodity:function(){var e=this,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.get("search/goods/list",{pageNum:1,pageSize:10,keyword:this.inputValue,khId:this.customerId,storehouseId:this.storehouseId,barCodeKeyword:this.barCodeKeyword},3).then((function(a){if(a.meta.success){var o=a.data.list.list;if(t.log("res",o),o.length>0){var r=Array.prototype.reduce.call(o||[],(function(t,a){var s=a.barCode,o=a.saleIP,r=a.saleSP,l=a.id,u=a.packingSpecification,d=a.modePrice,c=i?s==e.barCodeKeyword?0:1:0,f=i?c?0:1:0;1!=u||o!=r||e.useMultUnit||(c=1,f=0),e.useMultUnit&&(c=1,f=0);var h=Array.prototype.some.call(e.returnsList||[],(function(t){return t.id==l})),m=e.useMultUnit?(d*c).toFixed(4):parseFloat(parseFloat(o||0)*parseFloat(c)+parseFloat(r||0)*parseFloat(f)).toFixed(4);return t[~~h].push((0,n.default)((0,n.default)({},a),{},{remark:"",itemQuantity:c,scatteredQuantity:f,saleIP:o||0,saleSP:r||0,amount:m})),t}),[[],[]]),l=(0,s.default)(r,2),u=l[0],d=l[1];d.length>0?e.returnsList=e.returnsList.map((function(t){var e=d.find((function(e){return e.id==t.id}));if(e){var i=parseFloat(t.itemQuantity||0)+parseFloat(e.itemQuantity),a=parseFloat(t.scatteredQuantity||0)+parseFloat(e.scatteredQuantity),s=(parseFloat(t.amount||0)+parseFloat(e.amount)).toFixed(4);return(0,n.default)((0,n.default)({},t),{},{itemQuantity:i,scatteredQuantity:a,amount:s})}return t})).concat(u):e.returnsList=e.returnsList.concat(u),e.orderStat=!0}else uni.showToast({title:"暂无该商品",icon:"none",duration:1e3})}}))},closeOpen:function(t,e){this.returnsList[e].checked=!this.returnsList[e].checked,this.$forceUpdate()},saleDetaEvent:function(t,e){},priceIP:function(t,e){if(this.useMultUnit)this.getMultUnitChange(e,{modePrice:t.detail.value});else{var i=this.returnsList[e];i.saleIP=this.RegExp.floatRound4(t.detail.value),i.saleSP=this.RegExp.floatRound4(parseFloat(i.saleIP)/parseFloat(i.packingSpecification));var a=parseFloat(i.itemQuantity)*parseFloat(i.saleIP),s=parseFloat(i.scatteredQuantity)*parseFloat(i.saleSP);i.amount=parseFloat(a+s).toFixed(4)}},numberIP:function(e,i){if(this.useMultUnit)this.getMultUnitChange(i,{itemQuantity:e.detail.value});else{var a=this.returnsList[i];a.itemQuantity=this.RegExp.floatRound4(e.detail.value),t.log("item.itemQuantity：：",a.itemQuantity);var s=parseFloat(a.itemQuantity)*parseFloat(a.saleIP),n=parseFloat(a.scatteredQuantity)*parseFloat(a.saleSP);a.amount=parseFloat(s+n).toFixed(4)}},priceSP:function(e,i){t.log("priceSP:",e.detail.value);var a=this.returnsList[i];a.saleSP=this.RegExp.floatRound4(e.detail.value),a.saleIP=this.RegExp.floatRound4(parseFloat(a.saleSP)*parseFloat(a.packingSpecification));var s=parseFloat(a.itemQuantity)*parseFloat(a.saleIP),n=parseFloat(a.scatteredQuantity)*parseFloat(a.saleSP);a.amount=parseFloat(s+n).toFixed(4)},numberSP:function(e,i){t.log("numberSP:",e.detail.value);var a=this.returnsList[i];a.scatteredQuantity=this.RegExp.floatRound4(e.detail.value);var s=parseFloat(a.itemQuantity)*parseFloat(a.saleIP),n=parseFloat(a.scatteredQuantity)*parseFloat(a.saleSP);a.amount=parseFloat(s+n).toFixed(4)},goodsremarks:function(e,i){t.log("event.detail.value：：",e.detail.value),this.returnsList[i].remark=e.detail.value},delectItem:function(e,i){this.returnsList.splice(i,1),t.log("this.returnsList::",this.returnsList),this.returnsList.length>0&&uni.setStorageSync("salesReturn",this.returnsList),0==this.returnsList.length&&(this.orderStat=!1,uni.removeStorageSync("salesReturn"))},handleRequireController:function(){return!(this.requireConfig&&Object.keys(this.requireConfig).length>0&&this.fieldConfig&&Object.keys(this.fieldConfig).length>0&&this.fieldConfig.remark&&this.requireConfig.remark&&!this.remarksVal)||(uni.showToast({title:"请输入备注",icon:"none"}),!1)},creatNewDocm:function(){var e=this,i=this.handleRequireController();if(i){var a=[];t.log("this.returnsList::",this.returnsList);for(var s=0;s<this.returnsList.length;s++){var n={goodsId:0,saleIP:0,saleSP:0,itemQuantity:0,scatteredQuantity:0};n.goodsId=this.returnsList[s].id,n.saleDetailId=this.returnsList[s].saleDetailId||"",n.barCode=this.returnsList[s].barCode,n.saleIP=this.returnsList[s].saleIP,n.saleSP=this.returnsList[s].saleSP,n.itemQuantity=this.returnsList[s].itemQuantity,n.scatteredQuantity=this.returnsList[s].scatteredQuantity,n.packingSpecification=this.returnsList[s].packingSpecification,n.smallUnit=this.returnsList[s].smallUnit,n.picture=this.returnsList[s].picture,n.goodsName=this.returnsList[s].goodsName,n.brandName=this.returnsList[s].brandName,n.orderQuantity=this.returnsList[s].orderQuantity,n.remark=this.returnsList[s].remark,n.orderType=1,this.useMultUnit&&(n.specUnitPrice=this.returnsList[s].modePrice,n.multiunitId=this.returnsList[s].multiunitId,n.specUnitQuantity=this.returnsList[s].itemQuantity),a.push(n)}uni.showLoading({title:"开单中",mask:!0}),this.post("sale",{employeeId:this.employeeId,employeeName:this.employeeName,customerId:this.customerId,customerName:this.customerName,saleDetailList:a,storehouseId:this.storehouseId,remark:this.remarksVal,type:this.type,id:this.saleBillId?this.saleBillId:-1,fillDate:this.date},3).then((function(t){if(uni.hideLoading(),t&&t.meta&&0==t.meta.success)uni.showToast({title:t.meta.message,icon:"none",duration:3e3});else if(t.meta.success){e.switchTab=!0,e.categoryList=t.data;var i=e.saleNo?e.saleNo:t.data.obj.saleNo;uni.navigateTo({url:"../../publicPage/billSuccess/billSuccess?sourceType=203&saleNo="+i+"&id="+t.data.obj.id+"&totalAmount="+t.data.obj.totalAmount}),e.doRefresh()}else uni.showToast({icon:"none",title:t.meta.message,duration:2e3})}))}},unique:function(t,e){for(var i=t.concat(e),a={},s=[],n=0;n<i.length;n++)a["s_"+i[n].id]=i[n];for(var o in a)s.push(a[o]);return s},clearAllDate:function(){var t=this;uni.showModal({title:"温馨提示",content:"是否清空当前页面数据",success:function(e){e.confirm?(t.doRefresh(!0),t.$forceUpdate(),t.orderStat=!1):e.cancel}})},doRefresh:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.searchText="",this.customerName="",this.customerId="",this.warehouse="",this.storehouseId="",this.storehouseName="",this.remarksVal="",this.returnsList=[],this.$data.warehouseName="",this.saleBillId="",this.saleNo="",uni.removeStorageSync("salesReturn"),t&&uni.removeStorageSync("saleReturnNoteTemp")},initData:function(){uni.getStorageSync("saleReturnId")&&(this.saleBillId=uni.getStorageSync("saleReturnId"),t.log("11111",this.saleBillId),this.type="203",this.enquiryDocuments());var e=uni.getStorageSync("saleReturnNoteTemp");null!=e&&""!=e&&(this.strogeobj=e,this.customerName=e.customerName,this.customerId=e.customerId,this.storehouseName=e.storehouseName,this.storehouseId=e.storehouseId||""),uni.removeStorageSync("saleReturnId")},toHistory:function(){uni.setStorageSync("Type",203),uni.switchTab({url:"/pages/documentHistorys/index"})},setHeader:function(){uni.navigateTo({url:"../commodityListSet/commodityListSet?billTypeCode=app203&isHeader=1"})},datBillScreenConfigList:function(){var t=this,e={},i={};this.get("pub/billSetting/list",{singleType:"app203"},4).then((function(a){a.meta.success&&a.data.length>0?(a.data.forEach((function(t){t.prop&&(e[t.prop]=t.display),t.required&&(i[t.prop]=t.required)})),t.fieldConfig=(0,n.default)({},e),t.requireConfig=(0,n.default)({},i)):uni.showToast({icon:"none",title:a.meta.message,duration:2e3})}))},getSelectUnit:function(e){var i=this,a=this.returnsList[e],s={goodsId:a.id,customerId:i.customerId,storehouseId:i.storehouseId,type:203,longDate:(new Date).getTime()};i.$store.dispatch("getPrice",s).then((function(a){if(a.meta.success){if(!a.data.specUnitList.length)return void uni.showToast({icon:"none",title:"该商品没有设置多单位!",duration:2e3});var s=a.data.specUnitList;uni.showActionSheet({itemList:s.map((function(t){return"".concat(t.name," (1x").concat(t.packingSpecification,")")})),success:function(a){var n=s[a.tapIndex];t.log("selected",n),i.getMultUnitChange(e,n)},fail:function(e){t.log(e.errMsg)}})}else uni.showToast({icon:"none",title:a.meta.message,duration:2e3})}))},getMultUnitChange:function(t,e){var i=this.returnsList[t];e.modePrice&&(i.modePrice=e.modePrice),e.itemQuantity&&(i.itemQuantity=e.itemQuantity),e.id&&(i.multiunitId=e.id,i.specUnit=e.name,i.modePrice=e.modePrice,i.multipleUnitSpecification=e.packingSpecification),i.amount=(i.modePrice*i.itemQuantity).toFixed(4),this.$set(this.returnsList,t,i),uni.hideKeyboard()}}),watch:{returnsList:{handler:function(e,i){for(var a=[],s=0;s<e.length;s++){a.push(parseFloat(e[s].amount).toFixed(4));for(var n=0,o=a.length-1;o>=0;o--)n+=parseFloat(a[o]),t.log("监听---",n),this.total=n.toFixed(4)}},deep:!0},customer:function(e){t.log("newval",e),null!=e&&e.length>0&&(this.customerId=e[0].id,this.customerName=e[0].name,this.strogeobj.customerId=this.customerId,this.strogeobj.customerName=this.customerName,uni.setStorageSync("saleReturnNoteTemp",this.strogeobj))},storehouse:function(e){t.log("newval",e),null!=e&&e.length>0&&(this.storehouseName=e[0].name,this.storehouseId=e[0].id,this.strogeobj.storehouseName=this.storehouseName,this.strogeobj.storehouseId=this.storehouseId,uni.setStorageSync("saleReturnNoteTemp",this.strogeobj))}},onLoad:function(t){this.employeeId=uni.getStorageSync("id"),this.employeeName=uni.getStorageSync("name");var e=uni.getStorageSync("privilegeMap");1==e.priceAuth&&(this.noPriceChangeAllowed=!0),this.useMultUnit=uni.getStorageSync("useMultUnit")},onShow:function(){var t=uni.getStorageSync("salesReturn");if(0!=t.length){var e=uni.getStorageSync("salesReturn");this.returnsList=e,this.orderStat=!0}else this.orderStat=!1;this.initData(),this.datBillScreenConfigList()}};e.default=r}).call(this,i("ba7c")["default"])},"59b8":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAqBAMAAAA37dRoAAAAFVBMVEVHcEyXl5ebm5uXl5eXl5eYmJiXl5dhgIfDAAAABnRSTlMAugiMpToMNkwxAAAAU0lEQVQoz2NgGOwgUAGLIGuaEBZRxrRELIqZxLApZlJMS2HAqtiBQsUMOBUbYFWcTLxiRlIUYxXFah0T5UpTiA0d0pQqEBmb2GMeeyrBnqIGIQAA2U8VBfend9IAAAAASUVORK5CYII="},"5bc3":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAABN0lEQVRoge2YMQ6DMAxFOQhzD/BtxUOvwLV6HNaOHKkSbJ3oEqSoSmjSBhKKn+SFKMiPuPSLplH+EAAdEQ1ENNkaAHSl+4qCmW9ENPuKmW+l+1vFPnlv80tVfRJ2bJanfReRVkRaZr47EkPpPoPYeZ+JaBaRdrkuIq0jMJXscRV3VFLWqkEFSqMCpVGB0qhADt6S5Gqu2bHiEu1akqylgok2JknWUt6TIE+SzDKTGYhKtBRIkrXwMdH+g8CxR+jwP+KmOfhr9O0khpJNBirt04y7OXpTZn7qQQUyoAIq8CObCNj/isn3Ps69tokAET3t9adnT9a1rQSCN829pgIqoAInFxiXzcx83VuAma/O9TFZAEDv3rhkAeiTBYwxFwCPCpp/GGMuyQKORO+O0441Aui/bl5RTsILecwmw0E3NbEAAAAASUVORK5CYII="},7617:function(t,e,i){"use strict";i.r(e);var a=i("5058"),s=i.n(a);for(var n in a)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(n);e["default"]=s.a},"846e":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoAQMAAAC2MCouAAAABlBMVEVHcEyXl5c3HTAeAAAAAXRSTlMAQObYZgAAADNJREFUCNdjYCAG8DAYwEjm////H4CRQBE4CVQAJ5HVIIsjk/w2H+AkbjUIEpcaJLuIAABy9Sm5sM//IAAAAABJRU5ErkJggg=="},8824:function(t,e,i){"use strict";i("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("fd3c"),i("c223"),i("aa9c"),i("5ef2"),i("20f3");var a={previewPhoto:function(t,e){var i=e.map((function(t,e){return t.picture}));uni.previewImage({current:i[t],urls:i})},unique:function(t,e){for(var i=t.concat(e),a={},s=[],n=0;n<i.length;n++)a["s_"+i[n].id]=i[n];for(var o in a)s.push(a[o]);return s},IsPicture:function(t){if(t&&t.indexOf(".")>-1){var e=t.lastIndexOf("."),i=t.substring(e,t.length)+"|";if(i=i.toLowerCase(),".jpeg|.gif|.jpg|.png|.bmp|.pic|.svg|".indexOf(i)>-1)return!0}return!1}};e.default=a},9796:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAElBMVEVHcEz/uCL/uSP/uCL/vCL/uCJcCjI6AAAABXRSTlMA50mtJj8sjiYAAABlSURBVDjLY2AgHbAYhmIAYQeghGMoFiAClDDFJhEMlBDFJhEIlAgNxbQXLDbEJEQDMSXAYopCmBLYxAYHUAzFCoSwRyAoCnFK4DRqsHodV0ThjNphk3ZxZU6c2RlnAYCzyCAVAACHaG1xFoswbQAAAABJRU5ErkJggg=="},"9d36":function(t,e,i){var a=i("c86c");e=a(!1),e.push([t.i,"uni-page-body[data-v-06fb426f]{background-color:#f6f6f6}body.?%PAGE?%[data-v-06fb426f]{background-color:#f6f6f6}.head[data-v-06fb426f]{display:flex;justify-content:space-between;font-weight:590}.header-left[data-v-06fb426f]{width:20%}.header-middle[data-v-06fb426f]{width:25%}.head uni-image[data-v-06fb426f]{width:%?48?%;height:%?48?%;margin:%?7?% %?15?%;display:block}.header-right[data-v-06fb426f]{display:flex;\r\n\t/* width: 28%; */width:31%}.middle[data-v-06fb426f]{padding:%?40?%;margin-top:%?40?%}.item[data-v-06fb426f]{display:flex;height:%?80?%;line-height:%?80?%;padding-bottom:%?20?%}.item[data-v-06fb426f]:last-child{padding-bottom:0}.middle-des[data-v-06fb426f]{font-size:%?32?%;width:%?160?%;text-align:right}.middle-select[data-v-06fb426f]{display:flex;justify-content:space-between;background:#f7f6fb;width:%?496?%;font-size:%?30?%;border-radius:5px}uni-picker[data-v-06fb426f]{padding-left:%?20?%;width:%?496?%}.middle-select uni-input[data-v-06fb426f]{height:%?80?%;line-height:%?80?%;font-size:%?30?%;padding-left:%?20?%}.middle-select uni-text[data-v-06fb426f]{color:#ffb822;font-size:%?26?%;width:%?200?%}.middle-select uni-image[data-v-06fb426f]{width:%?40?%;height:%?40?%;padding-right:%?20?%;padding-top:%?20?%}.sweepCode[data-v-06fb426f]{border-bottom:%?2?% #eee solid;display:flex;justify-content:space-between}.sweepCode uni-image[data-v-06fb426f]{width:%?48?%;height:%?48?%;padding:%?26?% %?100?%}.order-item[data-v-06fb426f]{padding:%?40?% %?40?% 0 %?40?%}.order-item-top[data-v-06fb426f]{\r\n\t/* display: flex; */display:-webkit-box}.order-item-left[data-v-06fb426f]{width:%?160?%;height:%?160?%}.order-item-right[data-v-06fb426f]{\r\n\t/* flex: 1; */margin-left:%?20?%;display:flex}.order-inside[data-v-06fb426f]{display:flex;box-sizing:border-box;flex-direction:column;justify-content:space-between}.inside-left[data-v-06fb426f]{width:70%}.inside-right[data-v-06fb426f]{width:30%;align-items:flex-end}\r\n\r\n/* .order-fir {\r\n\tdisplay: flex;\r\n\tjustify-content: space-between;\r\n} */.order-fir-left[data-v-06fb426f]{font-size:%?32?%;font-weight:500;width:%?350?%}.order-fir-right[data-v-06fb426f]{font-size:%?32?%;font-weight:500;display:flex;justify-content:space-between}\r\n\r\n/* \r\n.order-sec {\r\n\tmargin-top: 20upx;\r\n\tdisplay: flex;\r\n\tjustify-content: space-between;\r\n} */.order-sec-left[data-v-06fb426f]{font-size:%?28?%;color:grey}.order-sec-right[data-v-06fb426f]{font-size:%?28?%;color:#3378ff}.order-item-bottom[data-v-06fb426f]{margin-top:%?20?%}.bottom-fir[data-v-06fb426f]{padding:%?20?% 0;display:flex;justify-content:space-between;border-bottom:%?1?% solid #eee;border-top:%?1?% solid #eee}.bottom-des[data-v-06fb426f]{font-size:%?28?%;color:grey}.bottom-input[data-v-06fb426f]{display:flex;align-items:center;flex-direction:column;justify-content:space-between;flex:1}.bottom-input uni-input[data-v-06fb426f]{margin-top:%?20?%;font-size:%?32?%;color:#333;text-align:center}.bottom-sec[data-v-06fb426f]{height:%?70?%;line-height:%?70?%;display:flex;font-size:%?28?%}.bottom-sec-des[data-v-06fb426f]{color:grey}.bottom-sec-input[data-v-06fb426f]{height:%?40?%;line-height:%?40?%;margin-top:%?10?%;color:grey;font-size:%?28?%}.bottom-sec-num[data-v-06fb426f]{flex:1;text-overflow:ellipsis;word-break:break-all;overflow:hidden}.bottom-sec-switch[data-v-06fb426f]{margin-left:%?20?%;display:flex;font-size:%?28?%;line-height:%?40?%;align-items:center}.bottom-sec-switch .switch[data-v-06fb426f]{-webkit-transform:scale(.6);transform:scale(.6)}.order-item-foot[data-v-06fb426f]{margin-top:%?40?%;border-bottom:%?1?% solid #eee}.foot-des[data-v-06fb426f]{margin:0 auto;display:flex;font-size:%?24?%;color:grey;width:20%;justify-content:space-between;padding:%?15?% 0;margin-bottom:%?20?%}.foot-des uni-image[data-v-06fb426f]{width:%?17?%;height:%?10?%;margin-top:%?10?%}.footfixed[data-v-06fb426f]{display:block;position:fixed;bottom:%?0?%!important;\r\nbottom:%?100?%;\r\nwidth:100%;height:%?100?%;background:#fff;z-index:10}.foot-bg[data-v-06fb426f]{display:flex;padding-left:%?40?%;align-items:center}.foot-bg-left[data-v-06fb426f]{display:flex;flex:1;font-size:%?32?%;font-weight:500;text-align:left;line-height:%?45?%;flex-direction:column}.foot-bg-left uni-image[data-v-06fb426f]{width:%?48?%;height:%?48?%;margin:%?25?% %?20?% 0 %?90?%}.foot-bg-left-text[data-v-06fb426f]{font-size:%?24?%;font-weight:400;color:grey;line-height:%?33?%}.foot-bg-right[data-v-06fb426f]{width:30%;height:%?100?%;line-height:%?100?%;text-align:center;background:#ffb822;font-size:%?32?%;color:#fff}.foot-bg-left uni-text[data-v-06fb426f]{color:red}\r\n\r\n/* 历史售价 */.modal-box[data-v-06fb426f]{width:100%;height:100%;position:fixed;background:rgba(51,51,51,.6);top:0;left:0;z-index:999}.modal-body[data-v-06fb426f]{width:%?670?%;height:%?970?%;background:#fff;margin:%?200?% auto 0 auto;border-radius:%?10?%}.modal-title[data-v-06fb426f]{display:block;width:100%;height:%?120?%;line-height:%?120?%;text-align:center;font-size:%?32?%;font-weight:500;color:#333}.modal-item[data-v-06fb426f]{display:flex;font-size:%?28?%;font-weight:400;color:#666;height:%?60?%;line-height:%?60?%;justify-content:space-between;padding:0 %?30?%;height:%?740?%}.modal-item-lef uni-text[data-v-06fb426f]:last-child{margin-left:%?30?%}.modal-foot[data-v-06fb426f]{height:%?100?%;line-height:%?100?%;text-align:center;border-top:%?1?% solid #eee;font-size:%?28?%;font-weight:400}.popup_overlay[data-v-06fb426f]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#000;z-index:1001;-moz-opacity:.8;opacity:.8;filter:alpha(opacity=88)}.popup_content[data-v-06fb426f]{position:fixed;top:50%;left:50%;width:%?520?%;height:%?550?%;margin-left:%?-270?%;margin-top:%?-270?%;border:10px solid #fff;background-color:#fff;z-index:1002;overflow:auto;border-radius:%?20?%}.popup_title[data-v-06fb426f]{padding-top:%?20?%;width:%?440?%;text-align:center;font-size:%?32?%}.popup_textarea_item[data-v-06fb426f]{padding-top:%?5?%;height:%?120?%;width:%?440?%;background-color:#f1f1f1;margin-top:%?30?%;margin-left:%?20?%}.popup_textarea[data-v-06fb426f]{width:%?410?%;font-size:%?26?%;margin-left:%?20?%}.popup_button[data-v-06fb426f]{color:#fff;background-color:#ffb822;border-radius:%?20?%}.alldiscount[data-v-06fb426f]{font-size:%?28?%;font-family:PingFangSC-Regular,PingFang SC;line-height:%?40?%;padding:%?40?%;background-color:#fff;display:flex;align-items:center}.alldiscount uni-input[data-v-06fb426f]{font-size:%?28?%;flex:1;text-align:right;margin-left:%?10?%}.gift[data-v-06fb426f]{font-size:%?24?%;font-weight:400;color:#ef2f46;line-height:%?33?%;margin-right:%?10?%;padding:%?8?% %?10?%;background:#fef5f4;border-radius:%?2?%}",""]),t.exports=e},"9ec0":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwAgMAAAAqbBEUAAAADFBMVEVHcEz/uCL/uSP/uCITuKUYAAAAA3RSTlMA4kmZPqyEAAAALklEQVQoz2NgAAHOBAYEYL+AxOH/MKI58//DwTeGegTnLyoHRdlouGFLSNAkBgCQylhTmhAbcAAAAABJRU5ErkJggg=="},b67f:function(t,e,i){var a=i("9d36");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var s=i("967d").default;s("230f34a9",a,!0,{sourceMap:!1,shadowMode:!1})},ce7f:function(t,e,i){"use strict";var a=i("b67f"),s=i.n(a);s.a}}]);