(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-sharePage-share-share"],{"00f3":function(t,e,i){var n=i("c86c");e=n(!1),e.push([t.i,".page[data-v-25e93721]{display:flex;flex-direction:column;font-size:%?32?%;font-family:PingFangSC-Medium,PingFang SC;font-weight:500;color:#333;line-height:%?45?%;height:100%;overflow:hidden}.page .content[data-v-25e93721]{flex:1;overflow:auto}.page .tools[data-v-25e93721]{display:flex;flex-direction:row;color:#ffb822;box-shadow:%?0?% %?2?% %?12?% %?0?% rgba(220,217,207,.5)}.page .tools .btn[data-v-25e93721]{padding:%?20?% 0;flex:1;text-align:center}.page .tools .btn[data-v-25e93721]:last-child{background-color:#ffb822;color:#fff}",""]),t.exports=e},"0c68":function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){}));var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"page"},[i("v-uni-view",{staticClass:"content"},[i("v-uni-canvas",{style:{width:t.canvasWidth+"px",height:t.canvasHeight+"px"},attrs:{"canvas-id":"firstCanvas",id:"firstCanvas"}})],1),i("v-uni-view",{staticClass:"tools"},[i("v-uni-view",{staticClass:"btn",on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.shareTowx.apply(void 0,arguments)}}},[t._v("分享到微信")]),i("v-uni-view",{staticClass:"btn",on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.saveImageToPhotosAlbum.apply(void 0,arguments)}}},[t._v("保存到本地")])],1)],1)},a=[]},1654:function(t,e,i){(function(e){i("bf0f"),t.exports={judgeIosPermission:function(t){return"location"==t?function(){var t,i=plus.ios.import("CLLocationManager"),n=i.authorizationStatus();return t=2!=n,e.log("定位权限开启："+t),plus.ios.deleteObject(i),t}():"camera"==t?function(){var t=!1,i=plus.ios.import("AVCaptureDevice"),n=i.authorizationStatusForMediaType("vide");return e.log("authStatus:"+n),3==n?(t=!0,e.log("相机权限已经开启")):e.log("相机权限没有开启"),plus.ios.deleteObject(i),t}():"photoLibrary"==t?function(){var t=!1,i=plus.ios.import("PHPhotoLibrary"),n=i.authorizationStatus();return e.log("authStatus:"+n),3==n?(t=!0,e.log("相册权限已经开启")):e.log("相册权限没有开启"),plus.ios.deleteObject(i),t}():"record"==t?function(){var t=!1,i=plus.ios.import("AVAudioSession"),n=i.sharedInstance(),a=n.recordPermission();return e.log("permissionStatus:"+a),1684369017==a||1970168948==a?e.log("麦克风权限没有开启"):(t=!0,e.log("麦克风权限已经开启")),plus.ios.deleteObject(i),t}():"push"==t?function(){var t=!1,i=plus.ios.import("UIApplication"),n=i.sharedApplication(),a=0;if(n.currentUserNotificationSettings){var o=n.currentUserNotificationSettings();a=o.plusGetAttribute("types"),e.log("enabledTypes1:"+a),0==a?e.log("推送权限没有开启"):(t=!0,e.log("已经开启推送功能!")),plus.ios.deleteObject(o)}else a=n.enabledRemoteNotificationTypes(),0==a?e.log("推送权限没有开启!"):(t=!0,e.log("已经开启推送功能!")),e.log("enabledTypes2:"+a);return plus.ios.deleteObject(n),plus.ios.deleteObject(i),t}():"contact"==t?function(){var t=!1,i=plus.ios.import("CNContactStore"),n=i.authorizationStatusForEntityType(0);return 3==n?(t=!0,e.log("通讯录权限已经开启")):e.log("通讯录权限没有开启"),plus.ios.deleteObject(i),t}():"calendar"==t?function(){var t=!1,i=plus.ios.import("EKEventStore"),n=i.authorizationStatusForEntityType(0);return 3==n?(t=!0,e.log("日历权限已经开启")):e.log("日历权限没有开启"),plus.ios.deleteObject(i),t}():"memo"==t&&function(){var t=!1,i=plus.ios.import("EKEventStore"),n=i.authorizationStatusForEntityType(1);return 3==n?(t=!0,e.log("备忘录权限已经开启")):e.log("备忘录权限没有开启"),plus.ios.deleteObject(i),t}()},requestAndroidPermission:function(t){return new Promise((function(i,n){plus.android.requestPermissions([t],(function(t){for(var n=0,a=0;a<t.granted.length;a++){var o=t.granted[a];e.log("已获取的权限："+o),n=1}for(a=0;a<t.deniedPresent.length;a++){var s=t.deniedPresent[a];e.log("拒绝本次申请的权限："+s),n=0}for(a=0;a<t.deniedAlways.length;a++){var r=t.deniedAlways[a];e.log("永久拒绝申请的权限："+r),n=-1}i(n)}),(function(t){e.log("申请权限错误："+t.code+" = "+t.message),i({code:t.code,message:t.message})}))}))},checkSystemEnableLocation:function(){var t=plus.android.importClass("android.content.Context"),i=plus.android.importClass("android.location.LocationManager"),n=plus.android.runtimeMainActivity(),a=n.getSystemService(t.LOCATION_SERVICE),o=a.isProviderEnabled(i.GPS_PROVIDER);return e.log("系统定位开启:"+o),o},gotoAppPermissionSetting:function(){var t=plus.android.importClass("android.content.Intent"),e=plus.android.importClass("android.provider.Settings"),i=plus.android.importClass("android.net.Uri"),n=plus.android.runtimeMainActivity(),a=new t;a.setAction(e.ACTION_APPLICATION_DETAILS_SETTINGS);var o=i.fromParts("package",n.getPackageName(),null);a.setData(o),n.startActivity(a)}}}).call(this,i("ba7c")["default"])},3175:function(t,e,i){var n=i("00f3");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var a=i("967d").default;a("bc8a8a90",n,!0,{sourceMap:!1,shadowMode:!1})},"5f5a":function(t,e,i){"use strict";(function(t){i("6a54");var n=i("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.setDPR=e.setCanvasHeight=e.Canvas=void 0;var a=n(i("2634")),o=n(i("2fdc"));i("f7a5"),i("fd3c"),i("bf0f"),i("18f7"),i("de6c"),i("c223"),i("2797");var s=n(i("63d3")),r=[{value:"客户名称",key:"customerName"},{value:"地址",key:"address"},{value:"订单号",key:"saleNo"},{value:"开单日期",key:"fillDate",handle:!0}];var c=function(t,e){return Math.floor(t/375*e)};e.setDPR=c;var u=function(t){var e=t.el,i=t.width,n=void 0===i?375:i,a=t.height,o=t.goodsList,s=void 0===o?[]:o,r=t.orderInfo,c=void 0===r?{}:r;this.el=e,this.startTopPonit=0,this.canvasWidth=n,this.canvasHeight=a,this.goodsList=s,this.orderInfo=c,this.setContext(),this.setDPR(),this.setSize()};e.Canvas=u,u.prototype.setContext=function(){this.context=uni.createCanvasContext(this.el)},u.prototype.setDPR=function(){this.MARGIN_20=c(this.canvasWidth,20),this.MARGIN_10=c(this.canvasWidth,10),this.MARGIN_5=c(this.canvasWidth,5),this.MARGIN_12=c(this.canvasWidth,12),this.MARGIN_6=c(this.canvasWidth,6),this.FONTSIZE_16=c(this.canvasWidth,16),this.FONTSIZE_12=c(this.canvasWidth,12),this.FONTSIZE_14=c(this.canvasWidth,14),this.IMGSIZE_80=c(this.canvasWidth,80),this.LiNEHEIGHT_22=c(this.canvasWidth,22),this.LiNEHEIGHT_16=c(this.canvasWidth,16),this.LiNEHEIGHT_10=c(this.canvasWidth,10),this.startLeftPonit=this.MARGIN_20},u.prototype.setSize=function(){this.rightLeftStartPonit=this.startLeftPonit+this.IMGSIZE_80+this.MARGIN_12,this.rightMaxWidth=this.canvasWidth-this.rightLeftStartPonit-this.MARGIN_20},u.prototype.setImages=(0,o.default)((0,a.default)().mark((function t(){var e;return(0,a.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.goodsList.map((function(t){var e=t.picture;return e})),t.next=3,Promise.all(this.getImagesFormData(e));case 3:this.images=t.sent;case 4:case"end":return t.stop()}}),t,this)}))),u.prototype.getImagesFormData=function(e){return Array.prototype.map.call(e,(function(e){return new Promise((function(i){e||i(null),uni.getImageInfo({src:e,success:function(){i(e)},fail:function(e){t.log(e),i(null)}})}))}))},u.prototype.setStartTopPonit=function(t){this.startTopPonit+=t},u.prototype.draw=(0,o.default)((0,a.default)().mark((function t(){return(0,a.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.setImages();case 2:this.drawBackgroud(),this.drawGoodsItem(),this.drawOrderAmt(),this.drawLine(this.LiNEHEIGHT_10,0),this.drawOrderInfo(),this.context.draw();case 8:case"end":return t.stop()}}),t,this)}))),u.prototype.drawBackgroud=function(){this.context.setFillStyle("#ffffff"),this.context.fillRect(0,0,this.canvasWidth,this.canvasHeight)},u.prototype.drawText=function(t){var e=t.value,i=t.fontWeight,n=void 0===i?0:i,a=t.fontSize,o=void 0===a?this.FONTSIZE_16:a,s=t.color,r=void 0===s?"#333333":s,c=t.textBaseline,u=void 0===c?"top":c,l=t.textAlign,h=void 0===l?"start":l,d=t.isSliceStr,f=void 0===d||d,p=t.textMaxWidth,v=void 0===p?this.canvasWidth:p,g=t.leftStartPonit,m=void 0===g?this.startLeftPonit:g,S=t.topStartPonit,I=void 0===S?this.startTopPonit:S;this.context.font="".concat(n?"normal normal ".concat(n," "):"").concat(o,"px PingFang SC"),this.context.setFillStyle(r),this.context.setTextBaseline(u),this.context.setTextAlign(h),this.context.fillText(f?function(t,e,i,n){var a=Math.floor(e/n),o=Math.floor(i/n);return a<o?t.slice(0,a)+"...":t}(e,v,this.getTextWidth(e),o):e,m,I)},u.prototype.drawGoodsItem=function(){var t=this;this.goodsList.forEach((function(e,i){t.drawContent(e,i),t.drawGoosAmt(e,i),t.drawLine()}))},u.prototype.drawContent=function(t,e){var i=t.name,n=t.code,a=t.packingSpecification;this.setStartTopPonit(this.MARGIN_20),this.drawImage(this.images[e]);var o=0;this.drawText({value:"".concat(i),fontSize:this.FONTSIZE_16,textMaxWidth:this.rightMaxWidth,leftStartPonit:this.rightLeftStartPonit,topStartPonit:this.startTopPonit+o}),o+=this.MARGIN_6+this.LiNEHEIGHT_22,this.drawText({value:"编号:".concat(n),fontSize:this.FONTSIZE_12,textMaxWidth:this.rightMaxWidth,leftStartPonit:this.rightLeftStartPonit,topStartPonit:this.startTopPonit+o,color:"#999999"}),o+=this.MARGIN_6+this.LiNEHEIGHT_16,this.drawText({value:"规格:1x".concat(a),fontSize:this.FONTSIZE_12,textMaxWidth:this.rightMaxWidth,leftStartPonit:this.rightLeftStartPonit,topStartPonit:this.startTopPonit+o,color:"#999999"})},u.prototype.drawImage=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.startLeftPonit,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.startTopPonit;t?this.context.drawImage(t,e,i,this.IMGSIZE_80,this.IMGSIZE_80):(this.context.setFillStyle("#EEEEEE"),this.context.fillRect(e,i,this.IMGSIZE_80,this.IMGSIZE_80),this.drawText({value:"暂无图片",isSliceStr:!1,fontSize:this.FONTSIZE_14,textAlign:"center",leftStartPonit:this.startLeftPonit+this.IMGSIZE_80/2,topStartPonit:this.startTopPonit+this.IMGSIZE_80/2,textBaseline:"middle",color:"#999999"}))},u.prototype.drawGoosAmt=function(t,e){var i=t.largeUnit,n=t.smallUnit,a=t.getIP,o=t.getSP,s=t.scatteredQuantity,r=t.itemQuantity;this.setStartTopPonit(this.IMGSIZE_80+this.MARGIN_5);var c="".concat(r?s?"¥".concat(a," x ").concat(r).concat(i," + ¥").concat(o," x ").concat(s).concat(n):"¥".concat(a," x ").concat(r).concat(i):s?"¥".concat(o," x ").concat(s).concat(n):"0");this.drawText({value:c,fontSize:this.FONTSIZE_14,color:"#EF2F46",textAlign:"end",isSliceStr:!1,leftStartPonit:this.canvasWidth-this.MARGIN_20}),this.setStartTopPonit(this.LiNEHEIGHT_16+this.MARGIN_10)},u.prototype.drawLine=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.startLeftPonit,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#EEEEEE";this.context.strokeStyle=i,this.context.lineWidth=t,this.context.beginPath(),this.context.moveTo(e,this.startTopPonit),this.context.lineTo(this.canvasWidth-e,this.startTopPonit),this.context.stroke(),this.setStartTopPonit(t)},u.prototype.drawOrderAmt=function(){var t=this,e=this.getOrderAmt(),i=e.totalAmount,n=e.settlementAmount,a=e.coupon,o=["¥".concat(n),"实收：","¥".concat(a," "),"优惠：","¥".concat(i," "),"应收："];this.setStartTopPonit(this.MARGIN_5);var s=this.canvasWidth-this.MARGIN_20;o.forEach((function(e,i){var n=i%2!==0?"#333333":"#EF2F46";t.drawText({value:e,fontSize:t.FONTSIZE_14,color:n,textAlign:"end",isSliceStr:!1,leftStartPonit:s}),s-=t.getTextWidth(e)})),this.setStartTopPonit(this.MARGIN_5+this.LiNEHEIGHT_16+this.MARGIN_10)},u.prototype.drawOrderInfo=function(){var t=this;this.setStartTopPonit(this.LiNEHEIGHT_16),this.drawText({value:"单据信息",fontSize:this.FONTSIZE_14,isSliceStr:!1,leftStartPonit:this.startLeftPonit,fontWeight:600}),this.setStartTopPonit(this.MARGIN_10+this.LiNEHEIGHT_16);var e=this.getOrderInfo(),i=this.canvasWidth-2*this.MARGIN_20;e.forEach((function(e){t.drawText({value:e,fontSize:t.FONTSIZE_14,textMaxWidth:i,leftStartPonit:t.startLeftPonit}),t.setStartTopPonit(t.LiNEHEIGHT_16)}))},u.prototype.getTextWidth=function(t){return this.context.measureText(t).width},u.prototype.getOrderInfo=function(){var t=this;return r.map((function(e){var i=e.key,n=e.value,a=e.handle;return"".concat(n,"：").concat(a?s.default.timeTransfer(t.orderInfo[i]):t.orderInfo[i])}))},u.prototype.getOrderAmt=function(){var t=this.orderInfo,e=t.totalAmount,i=t.settlementAmount,n=t.discountAmount;return{totalAmount:e,settlementAmount:i,coupon:n}},u.prototype.saveImage=function(){var t=this;return new Promise((function(e){uni.canvasToTempFilePath({destWidth:t.canvasWidth,destHeight:t.canvasHeight,canvasId:t.el,success:function(t){e(t.tempFilePath)},fail:function(t){uni.showToast({title:t,icon:"none"}),e(null)}})}))};e.setCanvasHeight=function(t,e){return c(t,136)*e+c(t,160)}}).call(this,i("ba7c")["default"])},"716b":function(t,e,i){"use strict";(function(t){i("6a54");var n=i("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=n(i("2634")),o=n(i("2fdc"));i("bf0f");var s=i("5f5a"),r=(i("1654"),function(t){return new Promise((function(e){setTimeout(e,t)}))}),c={data:function(){return{canvasHeight:0,canvasWidth:0,canvas:null,saleBillId:"",base64:"",photosAlbum:""}},onLoad:function(t){this.saleBillId=t.id||""},mounted:function(){var e=this;return(0,o.default)((0,a.default)().mark((function i(){return(0,a.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return t.log(e.base64,e.photosAlbum),i.next=3,e.createCanvas();case 3:case"end":return i.stop()}}),i)})))()},methods:{createCanvas:function(){var t=this;return(0,o.default)((0,a.default)().mark((function e(){var i,n,o,r;return(0,a.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return uni.showLoading({title:"正在绘画中..."}),e.next=3,t.getScreenWidth();case 3:return i=e.sent,t.canvasWidth=i||375,e.next=7,t.getSaleData();case 7:n=e.sent,n&&(o=n.detailList,r=n.main,t.canvasHeight=(0,s.setCanvasHeight)(t.canvasWidth,(o||[]).length),t.canvas=new s.Canvas({el:"firstCanvas",width:t.canvasWidth,height:t.canvasHeight,goodsList:o,orderInfo:r}),t.drawCanvas());case 9:case"end":return e.stop()}}),e)})))()},drawCanvas:function(){var t=this;return(0,o.default)((0,a.default)().mark((function e(){return(0,a.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,r(300);case 2:return e.next=4,t.canvas.draw();case 4:uni.hideLoading();case 5:case"end":return e.stop()}}),e)})))()},getScreenWidth:function(){return new Promise((function(t){uni.getSystemInfo({success:function(e){t(e.windowWidth)},fail:function(){t(null)}})}))},saveImage:function(){return(0,o.default)((0,a.default)().mark((function t(){return(0,a.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})))()},getSaleData:function(){var t=this;return(0,o.default)((0,a.default)().mark((function e(){var i;return(0,a.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.get("api/sale/getMainAndDetail",{id:t.saleBillId},1);case 2:if(i=e.sent,!i.meta.success){e.next=7;break}return e.abrupt("return",i.data);case 7:uni.hideLoading(),uni.showToast({title:i.meta.message||"接口报错",icon:"none",duration:2e3});case 9:case"end":return e.stop()}}),e)})))()},saveBase64ImgToApp:function(t){},saveImageToPhotosAlbum:function(){var t=this;return(0,o.default)((0,a.default)().mark((function e(){var i,n;return(0,a.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=t,!t.photosAlbum){e.next=5;break}e.t0=t.photosAlbum,e.next=8;break;case 5:return e.next=7,t.saveImage();case 7:e.t0=e.sent;case 8:n=e.t0,n&&uni.saveImageToPhotosAlbum({filePath:n,success:function(){uni.showToast({title:"保存成功",icon:"none",duration:2e3}),!i.photosAlbum&&(i.photosAlbum=n)},fail:function(){uni.showToast({title:"保存失败",icon:"none"})}});case 10:case"end":return e.stop()}}),e)})))()},shareTowx:function(){this.photosAlbum?uni.share({provider:"weixin",scene:"WXSceneSession",type:2,imageUrl:this.photosAlbum,success:function(t){uni.showToast({title:"分享成功",icon:"none",duration:2e3})},fail:function(t){uni.showToast({title:"分享失败",icon:"none",duration:2e3})}}):uni.showToast({title:"请先保存到本地相册",icon:"none",duration:2e3})}}};e.default=c}).call(this,i("ba7c")["default"])},c8ae:function(t,e,i){"use strict";i.r(e);var n=i("0c68"),a=i("cb43");for(var o in a)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(o);i("f4da2");var s=i("828b"),r=Object(s["a"])(a["default"],n["b"],n["c"],!1,null,"25e93721",null,!1,n["a"],void 0);e["default"]=r.exports},cb43:function(t,e,i){"use strict";i.r(e);var n=i("716b"),a=i.n(n);for(var o in n)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(o);e["default"]=a.a},f4da2:function(t,e,i){"use strict";var n=i("3175"),a=i.n(n);a.a}}]);